<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/grunt/node_modules/exit/test/exit_test.js</title>
  <link rel="stylesheet" href="../../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:21</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="exit_test.js.html/../../../../../../index.html">.</a> / <a href="exit_test.js.html/../../../../../index.html">node_modules</a> / <a href="exit_test.js.html/../../../../index.html">grunt</a> / <a href="exit_test.js.html/../../../index.html">node_modules</a> / <a href="exit_test.js.html/../../index.html">exit</a> / <a href="exit_test.js.html/../index.html">test</a> / exit_test.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="s1">&#39;use strict&#39;</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <p>======== A Handy Little Nodeunit Reference ========
  <a href="https://github.com/caolan/nodeunit">https://github.com/caolan/nodeunit</a></p>
<p>Test methods:
    test.expect(numAssertions)
    test.done()
  Test assertions:
    test.ok(value, [message])
    test.equal(actual, expected, [message])
    test.notEqual(actual, expected, [message])
    test.deepEqual(actual, expected, [message])
    test.notDeepEqual(actual, expected, [message])
    test.strictEqual(actual, expected, [message])
    test.notStrictEqual(actual, expected, [message])
    test.throws(block, [error], [message])
    test.doesNotThrow(block, [error], [message])
    test.ifError(value)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">exec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">exec</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">_which</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;which&#39;</span><span class="p">).</span><span class="nx">sync</span><span class="p">;</span>
<span class="kd">function</span> <span class="nx">which</span><span class="p">(</span><span class="nx">command</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">_which</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">command</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <p>Look for grep first (any OS). If not found (but on Windows) look for find,
which is Windows' horribly crippled grep alternative.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">grep</span> <span class="o">=</span> <span class="nx">which</span><span class="p">(</span><span class="s1">&#39;grep&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s1">&#39;win32&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">which</span><span class="p">(</span><span class="s1">&#39;find&#39;</span><span class="p">);</span>

<span class="nx">exports</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

  <span class="nx">setUp</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">origCwd</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">();</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="s1">&#39;test/fixtures&#39;</span><span class="p">);</span>
    <span class="nx">done</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">tearDown</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">process</span><span class="p">.</span><span class="nx">chdir</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">origCwd</span><span class="p">);</span>
    <span class="nx">done</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="s1">&#39;grep&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">test</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          <p>Many unit tests depend on this.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">test</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">grep</span><span class="p">,</span> <span class="s1">&#39;A suitable &quot;grep&quot; or &quot;find&quot; program was not found in the PATH.&#39;</span><span class="p">);</span>
    <span class="nx">test</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
  <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          <p>The rest of the tests are built dynamically, to keep things sane.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="p">};</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          <p>A few helper functions.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">function</span> <span class="nx">normalizeLineEndings</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\r?\n/g</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">);</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          <p>Capture command output, normalizing captured stdout to unix file endings.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">function</span> <span class="nx">run</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">exec</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span> <span class="o">?</span> <span class="nx">error</span><span class="p">.</span><span class="nx">code</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">normalizeLineEndings</span><span class="p">(</span><span class="nx">stdout</span><span class="p">));</span>
  <span class="p">});</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          <p>Read a fixture file, normalizing file contents to unix file endings.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">function</span> <span class="nx">fixture</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">normalizeLineEndings</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">filename</span><span class="p">)));</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">buildTests</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          <p>Build individual unit tests for command output.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">counts</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; stdout stderr&#39;</span><span class="p">,</span> <span class="s1">&#39; stdout&#39;</span><span class="p">,</span> <span class="s1">&#39; stderr&#39;</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">pipes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39; | &#39;</span> <span class="o">+</span> <span class="nx">grep</span> <span class="o">+</span> <span class="s1">&#39; &quot;std&quot;&#39;</span><span class="p">];</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">counts</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">outputs</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">output</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">pipes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">pipe</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">command</span> <span class="o">=</span> <span class="s1">&#39;node log.js 0 &#39;</span> <span class="o">+</span> <span class="nx">count</span> <span class="o">+</span> <span class="nx">output</span> <span class="o">+</span> <span class="s1">&#39; 2&gt;&amp;1&#39;</span> <span class="o">+</span> <span class="nx">pipe</span><span class="p">;</span>

        <span class="nx">exports</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">][</span><span class="s1">&#39;output (&#39;</span> <span class="o">+</span> <span class="nx">command</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">test</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nx">run</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">actual</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">expected</span> <span class="o">=</span> <span class="nx">fixture</span><span class="p">(</span><span class="nx">count</span> <span class="o">+</span> <span class="nx">output</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/ /g</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.txt&#39;</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          <p>Sometimes, the actual file lines are out of order on Windows.
But since the point of this lib is to drain the buffer and not
guarantee output order, we only test the length.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="nx">test</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">actual</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">expected</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="s1">&#39;should be the same length.&#39;</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          <p>The "fail" lines in log.js should NOT be output!</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="nx">test</span><span class="p">.</span><span class="nx">ok</span><span class="p">(</span><span class="nx">actual</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;fail&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;should not output after exit is called.&#39;</span><span class="p">);</span>
            <span class="nx">test</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
          <span class="p">});</span>
        <span class="p">};</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          <p>Build individual unit tests for exit codes.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">123</span><span class="p">];</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">codes</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">command</span> <span class="o">=</span> <span class="s1">&#39;node log.js &#39;</span> <span class="o">+</span> <span class="nx">code</span> <span class="o">+</span> <span class="s1">&#39; 10 stdout stderr&#39;</span><span class="p">;</span>

    <span class="nx">exports</span><span class="p">[</span><span class="s1">&#39;exit&#39;</span><span class="p">][</span><span class="s1">&#39;exit code (&#39;</span> <span class="o">+</span> <span class="nx">command</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">test</span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          <p>The specified exit code should be passed through.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">run</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">actual</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">test</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="nx">actual</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="s1">&#39;should exit with &#39;</span> <span class="o">+</span> <span class="nx">code</span> <span class="o">+</span> <span class="s1">&#39; error code.&#39;</span><span class="p">);</span>
        <span class="nx">test</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">};</span>
  <span class="p">});</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>Don't bother building tests if grep wasn't found, otherwise everything will
fail and the error will get lost.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">grep</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">buildTests</span><span class="p">();</span>
<span class="p">}</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
