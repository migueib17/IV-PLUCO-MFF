<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/grunt/node_modules/glob/glob.js</title>
  <link rel="stylesheet" href="../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:21</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="glob.js.html/../../../../../index.html">.</a> / <a href="glob.js.html/../../../../index.html">node_modules</a> / <a href="glob.js.html/../../../index.html">grunt</a> / <a href="glob.js.html/../../index.html">node_modules</a> / <a href="glob.js.html/../index.html">glob</a> / glob.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          <p>Approach:</p>
<ol>
<li>Get the minimatch set</li>
<li>For each pattern in the set, PROCESS(pattern)</li>
<li>Store matches per-set, then uniq them</li>
</ol>
<p>PROCESS(pattern)
Get the first [n] items from pattern that are all strings
Join these together.  This is PREFIX.
  If there is no more remaining, then stat(PREFIX) and
  add to matches if it succeeds.  END.
readdir(PREFIX) as ENTRIES
  If fails, END
  If pattern[n] is GLOBSTAR
handle the case where the globstar match is empty
by pruning it out, and testing the resulting pattern
    PROCESS(pattern[0..n] + pattern[n+1 .. <script type="math/tex">])
handle other cases.
    for ENTRY in ENTRIES (not dotfiles)
attach globstar + tail onto the entry
      PROCESS(pattern[0..n] + ENTRY + pattern[n .. </script>])</p>
<p>else // not globstar
    for ENTRY in ENTRIES (not dotfiles, unless pattern[n] is dot)
      Test ENTRY against pattern[n]
      If fails, continue
      If passes, PROCESS(pattern[0..n] + item + pattern[n+1 .. $])</p>
<p>Caveat:
  Cache all stats and readdirs results to minimize syscall.  Since all
  we ever care about is existence and directory-ness, we can just keep
  <code>true</code> for files, and [children,...] for directories, or <code>false</code> for
  things that don't exist.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">glob</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;graceful-fs&quot;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">minimatch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;minimatch&quot;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">Minimatch</span> <span class="o">=</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">Minimatch</span>
<span class="p">,</span> <span class="nx">inherits</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;inherits&quot;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">EE</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">).</span><span class="nx">EventEmitter</span>
<span class="p">,</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;path&quot;</span><span class="p">)</span>
<span class="p">,</span> <span class="nx">isDir</span> <span class="o">=</span> <span class="p">{}</span>
<span class="p">,</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">).</span><span class="nx">ok</span>

<span class="kd">function</span> <span class="nx">glob</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deprecated</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Glob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="k">return</span> <span class="nx">g</span><span class="p">.</span><span class="nx">sync</span> <span class="o">?</span> <span class="nx">g</span><span class="p">.</span><span class="nx">found</span> <span class="o">:</span> <span class="nx">g</span>
<span class="p">}</span>

<span class="nx">glob</span><span class="p">.</span><span class="nx">fnmatch</span> <span class="o">=</span> <span class="nx">deprecated</span>

<span class="kd">function</span> <span class="nx">deprecated</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;glob&#39;s interface has changed. Please see the docs.&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">glob</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="nx">globSync</span>
<span class="kd">function</span> <span class="nx">globSync</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">deprecated</span><span class="p">()</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="k">return</span> <span class="nx">glob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
<span class="p">}</span>


<span class="nx">glob</span><span class="p">.</span><span class="nx">Glob</span> <span class="o">=</span> <span class="nx">Glob</span>
<span class="nx">inherits</span><span class="p">(</span><span class="nx">Glob</span><span class="p">,</span> <span class="nx">EE</span><span class="p">)</span>
<span class="kd">function</span> <span class="nx">Glob</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Glob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">cb</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">matches</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">EOF</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">maxDepth</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxDepth</span> <span class="o">||</span> <span class="mi">1000</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">maxLength</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">maxLength</span> <span class="o">||</span> <span class="kc">Infinity</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">statCache</span> <span class="o">||</span> <span class="p">{}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">changedCwd</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="kd">var</span> <span class="nx">cwd</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s2">&quot;cwd&quot;</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">cwd</span> <span class="o">=</span> <span class="nx">cwd</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cwd</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">cwd</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">changedCwd</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cwd</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">cwd</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">root</span> <span class="o">||</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s2">&quot;win32&quot;</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">nomount</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nomount</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;must provide pattern&quot;</span><span class="p">)</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <p>base-matching: just use globstar for that.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">matchBase</span> <span class="o">&amp;&amp;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">===</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">noglobstar</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;base matching requires globstar&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">pattern</span> <span class="o">=</span> <span class="s2">&quot;**/&quot;</span> <span class="o">+</span> <span class="nx">pattern</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">strict</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">strict</span> <span class="o">!==</span> <span class="kc">false</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">dot</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">dot</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">mark</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">sync</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">nounique</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nounique</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">nonull</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nonull</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">nosort</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nosort</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">nocase</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nocase</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">stat</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">stat</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">debug</span> <span class="o">||</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">globDebug</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">silent</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">silent</span>

  <span class="kd">var</span> <span class="nx">mm</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minimatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">mm</span><span class="p">.</span><span class="nx">options</span>
  <span class="nx">pattern</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">=</span> <span class="nx">mm</span><span class="p">.</span><span class="nx">pattern</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">aborted</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="nx">EE</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <p>process each pattern in the minimatch set</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <p>The matches are stored as {<filename>: true,...} so that
duplicates are automagically pruned.
Later, we do an Object.keys() on these.
Keep them as a list so we can fill in when nonull is set.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">iterator</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">))</span>
  <span class="kd">function</span> <span class="nx">iterator</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">--</span> <span class="nx">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">_finish</span><span class="p">()</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">nou</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nounique</span>
  <span class="p">,</span> <span class="nx">all</span> <span class="o">=</span> <span class="nx">nou</span> <span class="o">?</span> <span class="p">[]</span> <span class="o">:</span> <span class="p">{}</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;matches[%d] =&quot;</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">matches</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          <p>do like the shell, and spit out the literal glob</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nonull</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">literal</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">globSet</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">nou</span><span class="p">)</span> <span class="nx">all</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">literal</span><span class="p">)</span>
        <span class="k">else</span> <span class="nx">all</span><span class="p">[</span><span class="nx">literal</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          <p>had matches</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">matches</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nou</span><span class="p">)</span> <span class="nx">all</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">else</span> <span class="nx">m</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">all</span><span class="p">[</span><span class="nx">m</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="p">})</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nou</span><span class="p">)</span> <span class="nx">all</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">all</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nosort</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">all</span> <span class="o">=</span> <span class="nx">all</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nocase</span> <span class="o">?</span> <span class="nx">alphasorti</span> <span class="o">:</span> <span class="nx">alphasort</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          <p>at <em>some</em> point we statted all of these</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">all</span> <span class="o">=</span> <span class="nx">all</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">sc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">m</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sc</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">m</span>
      <span class="kd">var</span> <span class="nx">isDir</span> <span class="o">=</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">sc</span><span class="p">)</span> <span class="o">||</span> <span class="nx">sc</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isDir</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDir</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/+$/</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">m</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;emitting end&quot;</span><span class="p">,</span> <span class="nx">all</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">EOF</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">found</span> <span class="o">=</span> <span class="nx">all</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">emitMatch</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">EOF</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">alphasorti</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
  <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
  <span class="k">return</span> <span class="nx">alphasort</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">alphasort</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="nx">b</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">abort</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">aborted</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;abort&quot;</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="k">return</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t pause/resume sync glob&quot;</span><span class="p">))</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;pause&quot;</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resume</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="k">return</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Can&#39;t pause/resume sync glob&quot;</span><span class="p">))</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;resume&quot;</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_processEmitQueue</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          <p>process.nextTick(this.emit.bind(this, "resume"))</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">emitMatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_processEmitQueue</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processEmitQueue</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_processingEmitQueue</span> <span class="o">&amp;&amp;</span>
         <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processingEmitQueue</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_processingEmitQueue</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">break</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;emit!&#39;</span><span class="p">,</span> <span class="nx">m</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">EOF</span> <span class="o">?</span> <span class="s2">&quot;end&quot;</span> <span class="o">:</span> <span class="s2">&quot;match&quot;</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">m</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">EOF</span> <span class="o">?</span> <span class="s2">&quot;end&quot;</span> <span class="o">:</span> <span class="s2">&quot;match&quot;</span><span class="p">,</span> <span class="nx">m</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processingEmitQueue</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_process</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">depth</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">cb_</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">cb</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">cb</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">&quot;resume&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">q</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span> <span class="o">=</span> <span class="kc">null</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nx">q</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">()</span> <span class="p">})</span>
        <span class="p">})</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">cb_</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">res</span><span class="p">))</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">cb_</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">depth</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxDepth</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          <p>Get the first [n] parts of pattern that are all strings.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">++</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>now n is the index of the first one that is <em>not</em> a string.</p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>see if there's anything else</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">prefix</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>if not, then this is rather simple</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">case</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span><span class="o">:</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          <p>either it's there, or it isn't.
nothing more to do, either way.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">_stat</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">exists</span><span class="p">,</span> <span class="nx">isDir</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">&amp;&amp;</span> <span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nomount</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
	    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
	    <span class="p">}</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s2">&quot;win32&quot;</span><span class="p">)</span>
            <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

          <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">||</span> <span class="p">{}</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">emitMatch</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
      <span class="p">})</span>
      <span class="k">return</span>

    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>pattern <em>starts</em> with some non-trivial item.
going to readdir(cwd), but not include the prefix in matches.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">prefix</span> <span class="o">=</span> <span class="kc">null</span>
      <span class="k">break</span>

    <span class="k">default</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          <p>pattern has some string bits in the front.
whatever it starts with, whether that's "absolute" like /foo/bar,
or "relative" like "../baz"</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          <p>get the list of entries.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">read</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">read</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">||</span> <span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prefix</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          <p>if (process.platform === "win32")
  read = prefix = prefix.replace(/^[a-zA-Z]:|\/g, "/")</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;absolute: &#39;</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">read</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="nx">prefix</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;readdir(%j)&#39;</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">read</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          <p>not a directory!
this means that, whatever else comes after this, it can never match</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>globstar is special</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">===</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">GLOBSTAR</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          <p>test without the globstar, and with every child both below
and replacing the globstar.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="p">]</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-31" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-31'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;.&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">dot</span><span class="p">)</span> <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-32" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-32'>#</a>
          </div>
          <p>instead of the globstar</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">s</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-33" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-33'>#</a>
          </div>
          <p>below the globstar</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">s</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">n</span><span class="p">)))</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-34" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-34'>#</a>
          </div>
          <p>now asyncForEach over this</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">length</span>
      <span class="p">,</span> <span class="nx">errState</span> <span class="o">=</span> <span class="kc">null</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-35" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-35'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">s</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">gsPattern</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">gsPattern</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">errState</span><span class="p">)</span> <span class="k">return</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">errState</span> <span class="o">=</span> <span class="nx">er</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="nx">l</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
        <span class="p">})</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">)</span>

      <span class="k">return</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-36" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-36'>#</a>
          </div>
          <p>not a globstar
It will only match dot entries if it starts with a dot, or if
dot is set.  Stuff like @(.foo|.bar) isn't allowed.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">pn</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pn</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">found</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">pn</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span>
      <span class="nx">entries</span> <span class="o">=</span> <span class="nx">found</span> <span class="o">?</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">pn</span><span class="p">]</span> <span class="o">:</span> <span class="p">[]</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">rawGlob</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">].</span><span class="nx">_glob</span>
      <span class="p">,</span> <span class="nx">dotOk</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dot</span> <span class="o">||</span> <span class="nx">rawGlob</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;.&quot;</span>

      <span class="nx">entries</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;.&quot;</span> <span class="o">||</span> <span class="nx">dotOk</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
               <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">e</span> <span class="o">===</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">||</span>
                <span class="nx">e</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]))</span>
      <span class="p">})</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-37" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-37'>#</a>
          </div>
          <p>If n === pattern.length - 1, then there's no need for the extra stat
unless* the user has specified "mark" or "stat" explicitly.
We know that they exist, since the readdir returned them.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">&amp;&amp;</span>
        <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">!==</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">e</span>
          <span class="k">else</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">e</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nomount</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s2">&quot;win32&quot;</span><span class="p">)</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">||</span> <span class="p">{}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emitMatch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-38" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-38'>#</a>
          </div>
          <p>now test all the remaining entries as stand-ins for that part
of the pattern.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span>
    <span class="p">,</span> <span class="nx">errState</span> <span class="o">=</span> <span class="kc">null</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">l</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span> <span class="c1">// no matches possible</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-39" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-39'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">e</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">errState</span><span class="p">)</span> <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">errState</span> <span class="o">=</span> <span class="nx">er</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="nx">l</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
  <span class="p">})</span>

<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-40" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-40'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_stat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="nx">f</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">abs</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">changedCwd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">abs</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">abs</span><span class="p">])</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">er</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Path name too long&quot;</span><span class="p">)</span>
    <span class="nx">er</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="s2">&quot;ENAMETOOLONG&quot;</span>
    <span class="nx">er</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">f</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterStat</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">exists</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span>
    <span class="p">,</span> <span class="nx">isDir</span> <span class="o">=</span> <span class="nx">exists</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="o">||</span> <span class="nx">exists</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">!!</span><span class="nx">exists</span><span class="p">,</span> <span class="nx">isDir</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="nx">cb</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">!!</span><span class="nx">exists</span><span class="p">,</span> <span class="nx">isDir</span><span class="p">))</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">stat</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">stat</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statSync</span><span class="p">(</span><span class="nx">abs</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">er</span> <span class="o">=</span> <span class="nx">e</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_afterStat</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterStat</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-41" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-41'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_afterStat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">exists</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">abs</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">stat</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;should be ENOTDIR, fake it&quot;</span><span class="p">)</span>

    <span class="nx">er</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;ENOTDIR, not a directory &#39;&quot;</span> <span class="o">+</span> <span class="nx">abs</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="nx">er</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">abs</span>
    <span class="nx">er</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="s2">&quot;ENOTDIR&quot;</span>
    <span class="nx">stat</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">er</span> <span class="o">||</span> <span class="o">!</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">exists</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">exists</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">||</span> <span class="nx">exists</span>
  <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">!!</span><span class="nx">exists</span><span class="p">,</span> <span class="nx">exists</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-42" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-42'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdir</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="nx">f</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">abs</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">abs</span> <span class="o">=</span> <span class="nx">f</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">changedCwd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">abs</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;readdir&#39;</span><span class="p">,</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">cwd</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">])</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">er</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Path name too long&quot;</span><span class="p">)</span>
    <span class="nx">er</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="s2">&quot;ENAMETOOLONG&quot;</span>
    <span class="nx">er</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">f</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterReaddir</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">f</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="nx">cb</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">c</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-43" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-43'>#</a>
          </div>
          <p>either ENOENT or ENOTDIR</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">?</span> <span class="s2">&quot;ENOTDIR&quot;</span> <span class="o">:</span> <span class="s2">&quot;ENOENT&quot;</span>
      <span class="p">,</span> <span class="nx">er</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">((</span><span class="nx">c</span> <span class="o">?</span> <span class="s2">&quot;Not a directory&quot;</span> <span class="o">:</span> <span class="s2">&quot;Not found&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">f</span><span class="p">)</span>
      <span class="nx">er</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">f</span>
      <span class="nx">er</span><span class="p">.</span><span class="nx">code</span> <span class="o">=</span> <span class="nx">code</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(</span><span class="nx">cb</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">))</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-44" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-44'>#</a>
          </div>
          <p>at this point, c === 2, meaning it's a dir, but we haven't
had to read it yet, or c === true, meaning it's <em>something</em>
but we don't have any idea what.  Need to read it, either way.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">entries</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">abs</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">er</span> <span class="o">=</span> <span class="nx">e</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterReaddir</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_afterReaddir</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">))</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-45" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-45'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_afterReaddir</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">entries</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entries</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-46" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-46'>#</a>
          </div>
          <p>if we haven't asked to stat everything for suresies, then just
assume that everything in there exists, so we can avoid
having to stat it a second time.  This also gets us one step
further into ELOOP territory.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">entries</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">f</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">f</span> <span class="o">+</span> <span class="nx">e</span>
        <span class="k">else</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">f</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nx">e</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-47" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-47'>#</a>
          </div>
          <p>now handle errors, and cache the information</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="k">switch</span> <span class="p">(</span><span class="nx">er</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&quot;ENOTDIR&quot;</span><span class="o">:</span> <span class="c1">// totally normal. means it *does* exist.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
    <span class="k">case</span> <span class="s2">&quot;ENOENT&quot;</span><span class="o">:</span> <span class="c1">// not terribly unusual</span>
    <span class="k">case</span> <span class="s2">&quot;ELOOP&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;ENAMETOOLONG&quot;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="o">:</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
    <span class="k">default</span><span class="o">:</span> <span class="c1">// some unusual error.  Treat as failure.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">f</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">strict</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;glob error&quot;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">isAbsolute</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s2">&quot;win32&quot;</span> <span class="o">?</span> <span class="nx">absWin</span> <span class="o">:</span> <span class="nx">absUnix</span>

<span class="kd">function</span> <span class="nx">absWin</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">absUnix</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="k">return</span> <span class="kc">true</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-48" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-48'>#</a>
          </div>
          <p>pull off the device/UNC bit from a windows path.
from node's lib/path.js</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">splitDeviceRe</span> <span class="o">=</span>
      <span class="sr">/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/</span>
    <span class="p">,</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">splitDeviceRe</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
    <span class="p">,</span> <span class="nx">device</span> <span class="o">=</span> <span class="nx">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span>
    <span class="p">,</span> <span class="nx">isUnc</span> <span class="o">=</span> <span class="nx">device</span> <span class="o">&amp;&amp;</span> <span class="nx">device</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;:&#39;</span>
    <span class="p">,</span> <span class="nx">isAbsolute</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="nx">isUnc</span> <span class="c1">// UNC paths are always absolute</span>

  <span class="k">return</span> <span class="nx">isAbsolute</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">absUnix</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">p</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;/&quot;</span> <span class="o">||</span> <span class="nx">p</span> <span class="o">===</span> <span class="s2">&quot;&quot;</span>
<span class="p">}</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
