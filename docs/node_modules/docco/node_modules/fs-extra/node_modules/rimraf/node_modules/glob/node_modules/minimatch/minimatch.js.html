<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/docco/node_modules/fs-extra/node_modules/rimraf/node_modules/glob/node_modules/minimatch/minimatch.js</title>
  <link rel="stylesheet" href="../../../../../../../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:19</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="minimatch.js.html/../../../../../../../../../../../index.html">.</a> / <a href="minimatch.js.html/../../../../../../../../../../index.html">node_modules</a> / <a href="minimatch.js.html/../../../../../../../../../index.html">docco</a> / <a href="minimatch.js.html/../../../../../../../../index.html">node_modules</a> / <a href="minimatch.js.html/../../../../../../../index.html">fs-extra</a> / <a href="minimatch.js.html/../../../../../../index.html">node_modules</a> / <a href="minimatch.js.html/../../../../../index.html">rimraf</a> / <a href="minimatch.js.html/../../../../index.html">node_modules</a> / <a href="minimatch.js.html/../../../index.html">glob</a> / <a href="minimatch.js.html/../../index.html">node_modules</a> / <a href="minimatch.js.html/../index.html">minimatch</a> / minimatch.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">minimatch</span>
<span class="nx">minimatch</span><span class="p">.</span><span class="nx">Minimatch</span> <span class="o">=</span> <span class="nx">Minimatch</span>

<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">sep</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span> <span class="p">}</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{}</span>

<span class="kd">var</span> <span class="nx">GLOBSTAR</span> <span class="o">=</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">GLOBSTAR</span> <span class="o">=</span> <span class="nx">Minimatch</span><span class="p">.</span><span class="nx">GLOBSTAR</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">var</span> <span class="nx">expand</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;brace-expansion&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <p>any single thing other than /
don't need to escape / when using new RegExp()</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">qmark</span> <span class="o">=</span> <span class="s1">&#39;[^/]&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <p>=&gt; any number of characters</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">star</span> <span class="o">=</span> <span class="nx">qmark</span> <span class="o">+</span> <span class="s1">&#39;*?&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <p>when dots are allowed.  Anything goes, except .. and .
not (^ or / followed by one or two dots followed by $ or /),
followed by anything, any number of times.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">twoStarDot</span> <span class="o">=</span> <span class="s1">&#39;(?:(?!(?:\\\/|^)(?:\\.{1,2})($|\\\/)).)*?&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          <p>not a ^ or / followed by a dot,
followed by anything, any number of times.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">twoStarNoDot</span> <span class="o">=</span> <span class="s1">&#39;(?:(?!(?:\\\/|^)\\.).)*?&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          <p>characters that need to be escaped in RegExp.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">reSpecials</span> <span class="o">=</span> <span class="nx">charSet</span><span class="p">(</span><span class="s1">&#39;().*{}+?[]^$\\!&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          <p>"abc" -&gt; { a:true, b:true, c:true }</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">function</span> <span class="nx">charSet</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">set</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span> <span class="nx">set</span>
  <span class="p">},</span> <span class="p">{})</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          <p>normalizes slashes.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">slashSplit</span> <span class="o">=</span> <span class="sr">/\/+/</span>

<span class="nx">minimatch</span><span class="p">.</span><span class="nx">filter</span> <span class="o">=</span> <span class="nx">filter</span>
<span class="kd">function</span> <span class="nx">filter</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span>

  <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">minimatch</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">ext</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">a</span> <span class="o">=</span> <span class="nx">a</span> <span class="o">||</span> <span class="p">{}</span>
  <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span> <span class="o">||</span> <span class="p">{}</span>
  <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">b</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
  <span class="p">})</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">a</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">t</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span>
  <span class="p">})</span>
  <span class="k">return</span> <span class="nx">t</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">minimatch</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">def</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">def</span> <span class="o">||</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">def</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">minimatch</span>

  <span class="kd">var</span> <span class="nx">orig</span> <span class="o">=</span> <span class="nx">minimatch</span>

  <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">minimatch</span> <span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">orig</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">ext</span><span class="p">(</span><span class="nx">def</span><span class="p">,</span> <span class="nx">options</span><span class="p">))</span>
  <span class="p">}</span>

  <span class="nx">m</span><span class="p">.</span><span class="nx">Minimatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Minimatch</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">orig</span><span class="p">.</span><span class="nx">Minimatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">ext</span><span class="p">(</span><span class="nx">def</span><span class="p">,</span> <span class="nx">options</span><span class="p">))</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">m</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Minimatch</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">def</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">def</span> <span class="o">||</span> <span class="o">!</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">def</span><span class="p">).</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="nx">Minimatch</span>
  <span class="k">return</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">defaults</span><span class="p">(</span><span class="nx">def</span><span class="p">).</span><span class="nx">Minimatch</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">minimatch</span> <span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;glob pattern string required&#39;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          <p>shortcut: comments match nothing.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nocomment</span> <span class="o">&amp;&amp;</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          <p>"" only matches ""</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">p</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">Minimatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Minimatch</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Minimatch</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Minimatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;glob pattern string required&#39;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          <p>windows support: need to use /, not \</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">sep</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">sep</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">negate</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">comment</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">empty</span> <span class="o">=</span> <span class="kc">false</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          <p>make the set of regexps etc.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">make</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{}</span>

<span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">make</span> <span class="o">=</span> <span class="nx">make</span>
<span class="kd">function</span> <span class="nx">make</span> <span class="p">()</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          <p>don't do it more than once.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_made</span><span class="p">)</span> <span class="k">return</span>

  <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          <p>empty patterns and comments match nothing.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nocomment</span> <span class="o">&amp;&amp;</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">comment</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">empty</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">return</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>step 1: figure out negation, etc.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">parseNegate</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>step 2: expand braces</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">set</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">globSet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">braceExpand</span><span class="p">()</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">debug</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">debug</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">error</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>step 3: now we have a set, so turn each one into a series of path-portion
matching patterns.
These will be regexps, except in the case of "**", which is
set to the GLOBSTAR object for globstar behavior,
and will not contain any / characters</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">set</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">globParts</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">slashSplit</span><span class="p">)</span>
  <span class="p">})</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          <p>glob --&gt; regexps</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">si</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">,</span> <span class="k">this</span><span class="p">)</span>
  <span class="p">},</span> <span class="k">this</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>filter out everything that didn't compile properly.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span>
  <span class="p">})</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="nx">set</span>
<span class="p">}</span>

<span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseNegate</span> <span class="o">=</span> <span class="nx">parseNegate</span>
<span class="kd">function</span> <span class="nx">parseNegate</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span>
  <span class="kd">var</span> <span class="nx">negate</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span>
  <span class="kd">var</span> <span class="nx">negateOffset</span> <span class="o">=</span> <span class="mi">0</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">nonegate</span><span class="p">)</span> <span class="k">return</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span>
    <span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span> <span class="o">&amp;&amp;</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;!&#39;</span>
    <span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">negate</span> <span class="o">=</span> <span class="o">!</span><span class="nx">negate</span>
    <span class="nx">negateOffset</span><span class="o">++</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">negateOffset</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">negateOffset</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">negate</span> <span class="o">=</span> <span class="nx">negate</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          <p>Brace expansion:
a{b,c}d -&gt; abd acd
a{b,}c -&gt; abc ac
a{0..3}d -&gt; a0d a1d a2d a3d
a{b,c{d,e}f}g -&gt; abg acdfg acefg
a{b,c}d{e,f}g -&gt; abdeg acdeg abdeg abdfg</p>
<p>Invalid sets are not expanded.
a{2..}b -&gt; a{2..}b
a{b}c -&gt; a{b}c</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">minimatch</span><span class="p">.</span><span class="nx">braceExpand</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">braceExpand</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">braceExpand</span> <span class="o">=</span> <span class="nx">braceExpand</span>

<span class="kd">function</span> <span class="nx">braceExpand</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Minimatch</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">pattern</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">pattern</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span>
    <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span> <span class="o">:</span> <span class="nx">pattern</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;undefined pattern&#39;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">nobrace</span> <span class="o">||</span>
    <span class="o">!</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\{.*\}/</span><span class="p">))</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          <p>shortcut. no need to expand.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="p">[</span><span class="nx">pattern</span><span class="p">]</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">expand</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          <p>parse a component of the expanded set.
At this point, no pattern may contain "/" in it
so we're going to return a 2d array, where each entry is the full
pattern, split on '/', and then turned into a regular expression.
A regexp is made at the end which joins each array with an
escaped /, and another full one which joins each regexp with |.</p>
<p>Following the lead of Bash 4.1, note that "<em><em>" only has special meaning
when it is the </em>only</em> thing in a path portion.  Otherwise, any series
of * is equivalent to a single *.  Globstar behavior is enabled by
default, and can be disabled by setting options.noglobstar.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parse</span> <span class="o">=</span> <span class="nx">parse</span>
<span class="kd">var</span> <span class="nx">SUBPARSE</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">function</span> <span class="nx">parse</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">isSub</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          <p>shortcuts</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">noglobstar</span> <span class="o">&amp;&amp;</span> <span class="nx">pattern</span> <span class="o">===</span> <span class="s1">&#39;**&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">GLOBSTAR</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">pattern</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>

  <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
  <span class="kd">var</span> <span class="nx">hasMagic</span> <span class="o">=</span> <span class="o">!!</span><span class="nx">options</span><span class="p">.</span><span class="nx">nocase</span>
  <span class="kd">var</span> <span class="nx">escaping</span> <span class="o">=</span> <span class="kc">false</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          <p>? =&gt; one single character</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">patternListStack</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="kd">var</span> <span class="nx">negativeLists</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="kd">var</span> <span class="nx">plType</span>
  <span class="kd">var</span> <span class="nx">stateChar</span>
  <span class="kd">var</span> <span class="nx">inClass</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="kd">var</span> <span class="nx">reClassStart</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="kd">var</span> <span class="nx">classStart</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>. and .. never match anything that doesn't start with .,
even when options.dot is set.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">patternStart</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="c1">// anything</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          <p>not (start or / followed by . or .. followed by / or end)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dot</span> <span class="o">?</span> <span class="s1">&#39;(?!(?:^|\\\/)\\.{1,2}(?:$|\\\/))&#39;</span>
  <span class="o">:</span> <span class="s1">&#39;(?!\\.)&#39;</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>

  <span class="kd">function</span> <span class="nx">clearStateChar</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">stateChar</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-31" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-31'>#</a>
          </div>
          <p>we had some state-tracking character
that wasn't consumed by this pass.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">switch</span> <span class="p">(</span><span class="nx">stateChar</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;*&#39;</span><span class="o">:</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="nx">star</span>
          <span class="nx">hasMagic</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">break</span>
        <span class="k">case</span> <span class="s1">&#39;?&#39;</span><span class="o">:</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="nx">qmark</span>
          <span class="nx">hasMagic</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">break</span>
        <span class="k">default</span><span class="o">:</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="nx">stateChar</span>
        <span class="k">break</span>
      <span class="p">}</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;clearStateChar %j %j&#39;</span><span class="p">,</span> <span class="nx">stateChar</span><span class="p">,</span> <span class="nx">re</span><span class="p">)</span>
      <span class="nx">stateChar</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">c</span>
    <span class="p">;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">))</span>
    <span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;%s\t%s %s %j&#39;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">re</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-32" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-32'>#</a>
          </div>
          <p>skip over any that are escaped.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">escaping</span> <span class="o">&amp;&amp;</span> <span class="nx">reSpecials</span><span class="p">[</span><span class="nx">c</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="nx">c</span>
      <span class="nx">escaping</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">continue</span>
    <span class="p">}</span>

    <span class="k">switch</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;/&#39;</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-33" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-33'>#</a>
          </div>
          <p>completely not allowed, even escaped.
Should already be path-split by now.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">return</span> <span class="kc">false</span>

      <span class="k">case</span> <span class="s1">&#39;\\&#39;</span><span class="o">:</span>
        <span class="nx">clearStateChar</span><span class="p">()</span>
        <span class="nx">escaping</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">continue</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-34" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-34'>#</a>
          </div>
          <p>the various stateChar values
for the "extglob" stuff.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">case</span> <span class="s1">&#39;?&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;*&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;+&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;@&#39;</span><span class="o">:</span>
      <span class="k">case</span> <span class="s1">&#39;!&#39;</span><span class="o">:</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;%s\t%s %s %j &lt;-- stateChar&#39;</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">re</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-35" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-35'>#</a>
          </div>
          <p>all of those are literals inside a class, except that
the glob [!a] means [^a] in regexp</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;  in class&#39;</span><span class="p">)</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;!&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">===</span> <span class="nx">classStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">c</span> <span class="o">=</span> <span class="s1">&#39;^&#39;</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="nx">c</span>
          <span class="k">continue</span>
        <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-36" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-36'>#</a>
          </div>
          <p>if we already have a stateChar, then it means
that there was something like ** or +? in there.
Handle the stateChar, then proceed with this one.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">self</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;call clearStateChar %j&#39;</span><span class="p">,</span> <span class="nx">stateChar</span><span class="p">)</span>
        <span class="nx">clearStateChar</span><span class="p">()</span>
        <span class="nx">stateChar</span> <span class="o">=</span> <span class="nx">c</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-37" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-37'>#</a>
          </div>
          <p>if extglob is disabled, then +(asdf|foo) isn't a thing.
just clear the statechar <em>now</em>, rather than even diving into
the patternList stuff.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">noext</span><span class="p">)</span> <span class="nx">clearStateChar</span><span class="p">()</span>
      <span class="k">continue</span>

      <span class="k">case</span> <span class="s1">&#39;(&#39;</span><span class="o">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span>
          <span class="k">continue</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stateChar</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\(&#39;</span>
          <span class="k">continue</span>
        <span class="p">}</span>

        <span class="nx">plType</span> <span class="o">=</span> <span class="nx">stateChar</span>
        <span class="nx">patternListStack</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">type</span><span class="o">:</span> <span class="nx">plType</span><span class="p">,</span>
          <span class="nx">start</span><span class="o">:</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
          <span class="nx">reStart</span><span class="o">:</span> <span class="nx">re</span><span class="p">.</span><span class="nx">length</span>
        <span class="p">})</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-38" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-38'>#</a>
          </div>
          <p>negation is (?:(?!js)[^/]*)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">re</span> <span class="o">+=</span> <span class="nx">stateChar</span> <span class="o">===</span> <span class="s1">&#39;!&#39;</span> <span class="o">?</span> <span class="s1">&#39;(?:(?!(?:&#39;</span> <span class="o">:</span> <span class="s1">&#39;(?:&#39;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;plType %j %j&#39;</span><span class="p">,</span> <span class="nx">stateChar</span><span class="p">,</span> <span class="nx">re</span><span class="p">)</span>
        <span class="nx">stateChar</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">continue</span>

      <span class="k">case</span> <span class="s1">&#39;)&#39;</span><span class="o">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span> <span class="o">||</span> <span class="o">!</span><span class="nx">patternListStack</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\)&#39;</span>
          <span class="k">continue</span>
        <span class="p">}</span>

        <span class="nx">clearStateChar</span><span class="p">()</span>
        <span class="nx">hasMagic</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;)&#39;</span>
        <span class="kd">var</span> <span class="nx">pl</span> <span class="o">=</span> <span class="nx">patternListStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">()</span>
        <span class="nx">plType</span> <span class="o">=</span> <span class="nx">pl</span><span class="p">.</span><span class="nx">type</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-39" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-39'>#</a>
          </div>
          <p>negation is (?:(?!js)[^/]*)
The others are (?:<pattern>)<type></p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">switch</span> <span class="p">(</span><span class="nx">plType</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s1">&#39;!&#39;</span><span class="o">:</span>
            <span class="nx">negativeLists</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pl</span><span class="p">)</span>
            <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;)[^/]*?)&#39;</span>
            <span class="nx">pl</span><span class="p">.</span><span class="nx">reEnd</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">length</span>
            <span class="k">break</span>
          <span class="k">case</span> <span class="s1">&#39;?&#39;</span><span class="o">:</span>
          <span class="k">case</span> <span class="s1">&#39;+&#39;</span><span class="o">:</span>
          <span class="k">case</span> <span class="s1">&#39;*&#39;</span><span class="o">:</span>
            <span class="nx">re</span> <span class="o">+=</span> <span class="nx">plType</span>
            <span class="k">break</span>
          <span class="k">case</span> <span class="s1">&#39;@&#39;</span><span class="o">:</span> <span class="k">break</span> <span class="c1">// the default anyway</span>
        <span class="p">}</span>
      <span class="k">continue</span>

      <span class="k">case</span> <span class="s1">&#39;|&#39;</span><span class="o">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span> <span class="o">||</span> <span class="o">!</span><span class="nx">patternListStack</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">escaping</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\|&#39;</span>
          <span class="nx">escaping</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="k">continue</span>
        <span class="p">}</span>

        <span class="nx">clearStateChar</span><span class="p">()</span>
        <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;|&#39;</span>
      <span class="k">continue</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-40" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-40'>#</a>
          </div>
          <p>these are mostly the same in regexp and glob</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">case</span> <span class="s1">&#39;[&#39;</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-41" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-41'>#</a>
          </div>
          <p>swallow any state-tracking char before the [</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">clearStateChar</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="nx">c</span>
          <span class="k">continue</span>
        <span class="p">}</span>

        <span class="nx">inClass</span> <span class="o">=</span> <span class="kc">true</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-42" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-42'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">classStart</span> <span class="o">=</span> <span class="nx">i</span>
        <span class="nx">reClassStart</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">length</span>
        <span class="nx">re</span> <span class="o">+=</span> <span class="nx">c</span>
      <span class="k">continue</span>

      <span class="k">case</span> <span class="s1">&#39;]&#39;</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-43" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-43'>#</a>
          </div>
          <p>a right bracket shall lose its special
meaning and represent itself in
a bracket expression if it occurs
first in the list.  -- POSIX.2 2.8.3.2</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span> <span class="o">===</span> <span class="nx">classStart</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">||</span> <span class="o">!</span><span class="nx">inClass</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="nx">c</span>
          <span class="nx">escaping</span> <span class="o">=</span> <span class="kc">false</span>
          <span class="k">continue</span>
        <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-44" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-44'>#</a>
          </div>
          <p>handle the case where we left a class open.
"[z-a]" is valid, equivalent to "<script type="math/tex; mode=display">z-a</script>"</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-45" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-45'>#</a>
          </div>
          <p>split where the last [ was, make sure we don't have
an invalid re. if so, re-walk the contents of the
would-be class to re-translate any characters that
were passed through as-is
<span class=todo><strong>TODO</strong>: It would probably be faster to determine this</span>
without a try/catch and a new RegExp, but it's tricky
to do safely.  For now, this is safe and works.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">cs</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">classStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span>
          <span class="k">try</span> <span class="p">{</span>
            <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nx">cs</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
          <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-46" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-46'>#</a>
          </div>
          <p>not a valid class!</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">sp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">cs</span><span class="p">,</span> <span class="nx">SUBPARSE</span><span class="p">)</span>
            <span class="nx">re</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">reClassStart</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\\[&#39;</span> <span class="o">+</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;\\]&#39;</span>
            <span class="nx">hasMagic</span> <span class="o">=</span> <span class="nx">hasMagic</span> <span class="o">||</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nx">inClass</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="k">continue</span>
          <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-47" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-47'>#</a>
          </div>
          <p>finish up the class.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">hasMagic</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="nx">inClass</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="nx">re</span> <span class="o">+=</span> <span class="nx">c</span>
      <span class="k">continue</span>

      <span class="k">default</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-48" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-48'>#</a>
          </div>
          <p>swallow any state char that wasn't consumed</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">clearStateChar</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">escaping</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-49" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-49'>#</a>
          </div>
          <p>no need</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nx">escaping</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">reSpecials</span><span class="p">[</span><span class="nx">c</span><span class="p">]</span>
          <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;^&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">inClass</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\&#39;</span>
        <span class="p">}</span>

        <span class="nx">re</span> <span class="o">+=</span> <span class="nx">c</span>

    <span class="p">}</span> <span class="c1">// switch</span>
  <span class="p">}</span> <span class="c1">// for</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-50" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-50'>#</a>
          </div>
          <p>handle the case where we left a class open.
"[abc" is valid, equivalent to "[abc"</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">inClass</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-51" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-51'>#</a>
          </div>
          <p>split where the last [ was, and escape it
this is a huge pita.  We now have to re-walk
the contents of the would-be class to re-translate
any characters that were passed through as-is</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">cs</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">classStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nx">sp</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">cs</span><span class="p">,</span> <span class="nx">SUBPARSE</span><span class="p">)</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">reClassStart</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\\[&#39;</span> <span class="o">+</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">hasMagic</span> <span class="o">=</span> <span class="nx">hasMagic</span> <span class="o">||</span> <span class="nx">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-52" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-52'>#</a>
          </div>
          <p>handle the case where we had a +( thing at the <em>end</em>
of the pattern.
each pattern list stack adds 3 chars, and we need to go through
and escape any | chars that were passed through as-is for the regexp.
Go through and escape them, taking care not to double-escape any
| chars that were already escaped.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="nx">pl</span> <span class="o">=</span> <span class="nx">patternListStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="nx">pl</span><span class="p">;</span> <span class="nx">pl</span> <span class="o">=</span> <span class="nx">patternListStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tail</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">pl</span><span class="p">.</span><span class="nx">reStart</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-53" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-53'>#</a>
          </div>
          <p>maybe some even number of \, then maybe 1 \, followed by a |</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">tail</span> <span class="o">=</span> <span class="nx">tail</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/((?:\\{2})*)(\\?)\|/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">_</span><span class="p">,</span> <span class="nx">$1</span><span class="p">,</span> <span class="nx">$2</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$2</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-54" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-54'>#</a>
          </div>
          <p>the | isn't already escaped, so escape it.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">$2</span> <span class="o">=</span> <span class="s1">&#39;\\&#39;</span>
      <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-55" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-55'>#</a>
          </div>
          <p>need to escape all those slashes <em>again</em>, without escaping the
one that we need for escaping the | character.  As it works out,
escaping an even number of slashes can be done by simply repeating
it exactly after itself.  That's why this trick works.</p>
<p>I am sorry that you have to see this.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">$1</span> <span class="o">+</span> <span class="nx">$1</span> <span class="o">+</span> <span class="nx">$2</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span>
    <span class="p">})</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;tail=%j\n   %s&#39;</span><span class="p">,</span> <span class="nx">tail</span><span class="p">,</span> <span class="nx">tail</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">pl</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;*&#39;</span> <span class="o">?</span> <span class="nx">star</span>
      <span class="o">:</span> <span class="nx">pl</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;?&#39;</span> <span class="o">?</span> <span class="nx">qmark</span>
      <span class="o">:</span> <span class="s1">&#39;\\&#39;</span> <span class="o">+</span> <span class="nx">pl</span><span class="p">.</span><span class="nx">type</span>

    <span class="nx">hasMagic</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">pl</span><span class="p">.</span><span class="nx">reStart</span><span class="p">)</span> <span class="o">+</span> <span class="nx">t</span> <span class="o">+</span> <span class="s1">&#39;\\(&#39;</span> <span class="o">+</span> <span class="nx">tail</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-56" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-56'>#</a>
          </div>
          <p>handle trailing things that only matter at the very end.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">clearStateChar</span><span class="p">()</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">escaping</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-57" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-57'>#</a>
          </div>
          <p>trailing \</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">re</span> <span class="o">+=</span> <span class="s1">&#39;\\\\&#39;</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-58" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-58'>#</a>
          </div>
          <p>only need to apply the nodot start if the re starts with
something that could conceivably capture a dot</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">addPatternStart</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">re</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;.&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s1">&#39;[&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s1">&#39;(&#39;</span><span class="o">:</span> <span class="nx">addPatternStart</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-59" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-59'>#</a>
          </div>
          <p>Hack to work around lack of negative lookbehind in JS
A pattern like: *.!(x).!(y|z) needs to ensure that a name
like 'a.xyz.yz' doesn't match.  So, the first negative
lookahead, has to look ALL the way ahead, to the end of
the pattern.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">negativeLists</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="nx">n</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">nl</span> <span class="o">=</span> <span class="nx">negativeLists</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span>

    <span class="kd">var</span> <span class="nx">nlBefore</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">nl</span><span class="p">.</span><span class="nx">reStart</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">nlFirst</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">nl</span><span class="p">.</span><span class="nx">reStart</span><span class="p">,</span> <span class="nx">nl</span><span class="p">.</span><span class="nx">reEnd</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">nlLast</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">nl</span><span class="p">.</span><span class="nx">reEnd</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span> <span class="nx">nl</span><span class="p">.</span><span class="nx">reEnd</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">nlAfter</span> <span class="o">=</span> <span class="nx">re</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">nl</span><span class="p">.</span><span class="nx">reEnd</span><span class="p">)</span>

    <span class="nx">nlLast</span> <span class="o">+=</span> <span class="nx">nlAfter</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-60" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-60'>#</a>
          </div>
          <p>Handle nested stuff like <em>(</em>.js|!(<em>.json)), where open parens
mean that we should </em>not* include the ) in the bit that is considered
"after" the negated section.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">openParensBefore</span> <span class="o">=</span> <span class="nx">nlBefore</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="kd">var</span> <span class="nx">cleanAfter</span> <span class="o">=</span> <span class="nx">nlAfter</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">openParensBefore</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cleanAfter</span> <span class="o">=</span> <span class="nx">cleanAfter</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\)[+*?]?/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="nx">nlAfter</span> <span class="o">=</span> <span class="nx">cleanAfter</span>

    <span class="kd">var</span> <span class="nx">dollar</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">nlAfter</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">isSub</span> <span class="o">!==</span> <span class="nx">SUBPARSE</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">dollar</span> <span class="o">=</span> <span class="s1">&#39;$&#39;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">newRe</span> <span class="o">=</span> <span class="nx">nlBefore</span> <span class="o">+</span> <span class="nx">nlFirst</span> <span class="o">+</span> <span class="nx">nlAfter</span> <span class="o">+</span> <span class="nx">dollar</span> <span class="o">+</span> <span class="nx">nlLast</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="nx">newRe</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-61" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-61'>#</a>
          </div>
          <p>if the re is not "" at this point, then we need to make sure
it doesn't match against an empty path part.
Otherwise a/* will match a/, which it should not.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">re</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">hasMagic</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="s1">&#39;(?=.)&#39;</span> <span class="o">+</span> <span class="nx">re</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">addPatternStart</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">re</span> <span class="o">=</span> <span class="nx">patternStart</span> <span class="o">+</span> <span class="nx">re</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-62" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-62'>#</a>
          </div>
          <p>parsing just a piece of a larger pattern.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">isSub</span> <span class="o">===</span> <span class="nx">SUBPARSE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="nx">re</span><span class="p">,</span> <span class="nx">hasMagic</span><span class="p">]</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-63" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-63'>#</a>
          </div>
          <p>skip the regexp for non-magical patterns
unescape anything in it, though, so that it'll be
an exact match against a file etc.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hasMagic</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">globUnescape</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">flags</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">nocase</span> <span class="o">?</span> <span class="s1">&#39;i&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="kd">var</span> <span class="nx">regExp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">re</span> <span class="o">+</span> <span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span>

  <span class="nx">regExp</span><span class="p">.</span><span class="nx">_glob</span> <span class="o">=</span> <span class="nx">pattern</span>
  <span class="nx">regExp</span><span class="p">.</span><span class="nx">_src</span> <span class="o">=</span> <span class="nx">re</span>

  <span class="k">return</span> <span class="nx">regExp</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-64" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-64'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">minimatch</span><span class="p">.</span><span class="nx">makeRe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="nx">Minimatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}).</span><span class="nx">makeRe</span><span class="p">()</span>
<span class="p">}</span>

<span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">makeRe</span> <span class="o">=</span> <span class="nx">makeRe</span>
<span class="kd">function</span> <span class="nx">makeRe</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-65" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-65'>#</a>
          </div>
          <p>at this point, this.set is a 2d array of partial
pattern strings, or "**".</p>
<p>It's better to use .match().  This function shouldn't
be used, really, but it's pretty convenient sometimes,
when you just want to work with a regex.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">set</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span>

  <span class="kd">var</span> <span class="nx">twoStar</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">noglobstar</span> <span class="o">?</span> <span class="nx">star</span>
    <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dot</span> <span class="o">?</span> <span class="nx">twoStarDot</span>
    <span class="o">:</span> <span class="nx">twoStarNoDot</span>
  <span class="kd">var</span> <span class="nx">flags</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">nocase</span> <span class="o">?</span> <span class="s1">&#39;i&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-66" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-66'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">re</span> <span class="o">=</span> <span class="nx">set</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">return</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">p</span> <span class="o">===</span> <span class="nx">GLOBSTAR</span><span class="p">)</span> <span class="o">?</span> <span class="nx">twoStar</span>
      <span class="o">:</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">p</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">regExpEscape</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
      <span class="o">:</span> <span class="nx">p</span><span class="p">.</span><span class="nx">_src</span>
    <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\\\/&#39;</span><span class="p">)</span>
  <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-67" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-67'>#</a>
          </div>
          <p>must match entire pattern
ending in a * or ** will make it less strict.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">re</span> <span class="o">=</span> <span class="s1">&#39;^(?:&#39;</span> <span class="o">+</span> <span class="nx">re</span> <span class="o">+</span> <span class="s1">&#39;)$&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-68" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-68'>#</a>
          </div>
          <p>can match anything, as long as it's not this.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">negate</span><span class="p">)</span> <span class="nx">re</span> <span class="o">=</span> <span class="s1">&#39;^(?!&#39;</span> <span class="o">+</span> <span class="nx">re</span> <span class="o">+</span> <span class="s1">&#39;).*$&#39;</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">re</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-69" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-69'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">minimatch</span><span class="p">.</span><span class="nx">match</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{}</span>
  <span class="kd">var</span> <span class="nx">mm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Minimatch</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

  <span class="nx">list</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">mm</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">mm</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">nonull</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">list</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pattern</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">list</span>
<span class="p">}</span>

<span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">match</span>
<span class="kd">function</span> <span class="nx">match</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">partial</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;match&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-70" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-70'>#</a>
          </div>
          <p>short-circuit in the case of busted things.
comments, etc.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">comment</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">empty</span><span class="p">)</span> <span class="k">return</span> <span class="nx">f</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">partial</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span>

  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-71" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-71'>#</a>
          </div>
          <p>windows: need to use /, not \</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">sep</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">sep</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-72" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-72'>#</a>
          </div>
          <p>treat the test path as a set of pathparts.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">f</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">slashSplit</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="s1">&#39;split&#39;</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-73" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-73'>#</a>
          </div>
          <p>just ONE of the pattern sets in this.set needs to match
in order for it to be valid.  If negating, then just one
match means that we have failed.
Either way, return on the first hit.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">set</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">set</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">pattern</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">,</span> <span class="nx">set</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-74" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-74'>#</a>
          </div>
          <p>Find the basename of the path by looking for the last non-empty segment</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">filename</span>
  <span class="kd">var</span> <span class="nx">i</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">filename</span> <span class="o">=</span> <span class="nx">f</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="k">break</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">set</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">pattern</span> <span class="o">=</span> <span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">f</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">matchBase</span> <span class="o">&amp;&amp;</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">file</span> <span class="o">=</span> <span class="p">[</span><span class="nx">filename</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">hit</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matchOne</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">partial</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">hit</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">flipNegate</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span>
      <span class="k">return</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">negate</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-75" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-75'>#</a>
          </div>
          <p>didn't get any hits.  this is success if it's a negative
pattern, failure otherwise.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">flipNegate</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">negate</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-76" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-76'>#</a>
          </div>
          <p>set partial to true to test if, for example,
"/a/b" matches the start of "/<em>/b/</em>/d"
Partial means, if you run out of file before you run
out of pattern, then that's fine, as long as all
the parts match.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Minimatch</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matchOne</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">partial</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;matchOne&#39;</span><span class="p">,</span>
    <span class="p">{</span> <span class="s1">&#39;this&#39;</span><span class="o">:</span> <span class="k">this</span><span class="p">,</span> <span class="nx">file</span><span class="o">:</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">pattern</span><span class="o">:</span> <span class="nx">pattern</span> <span class="p">})</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;matchOne&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">fi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">pi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">fl</span> <span class="o">=</span> <span class="nx">file</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
      <span class="nx">pl</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span>
      <span class="p">;</span> <span class="p">(</span><span class="nx">fi</span> <span class="o">&lt;</span> <span class="nx">fl</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">pi</span> <span class="o">&lt;</span> <span class="nx">pl</span><span class="p">)</span>
      <span class="p">;</span> <span class="nx">fi</span><span class="o">++</span><span class="p">,</span> <span class="nx">pi</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;matchOne loop&#39;</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">pi</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">file</span><span class="p">[</span><span class="nx">fi</span><span class="p">]</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-77" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-77'>#</a>
          </div>
          <p>should be impossible.
some invalid regexp stuff in the set.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">p</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">p</span> <span class="o">===</span> <span class="nx">GLOBSTAR</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;GLOBSTAR&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">f</span><span class="p">])</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-78" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-78'>#</a>
          </div>
          <p>"<strong>"
a/</strong>/b/<strong>/c would match the following:
a/b/x/y/z/c
a/x/y/z/b/c
a/b/x/b/x/c
a/b/c
To do this, take the rest of the pattern after
the </strong>, and see if it would match the file remainder.
If so, return success.
If not, the ** "swallows" a segment, and try again.
This is recursively awful.</p>
<p>a/<strong>/b/</strong>/c matching a/b/x/y/z/c
- a matches a
- doublestar
  - matchOne(b/x/y/z/c, b/**/c)
    - b matches b
    - doublestar
      - matchOne(x/y/z/c, c) -&gt; no
      - matchOne(y/z/c, c) -&gt; no
      - matchOne(z/c, c) -&gt; no
      - matchOne(c, c) yes, hit</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">fr</span> <span class="o">=</span> <span class="nx">fi</span>
      <span class="kd">var</span> <span class="nx">pr</span> <span class="o">=</span> <span class="nx">pi</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pr</span> <span class="o">===</span> <span class="nx">pl</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;** at the end&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-79" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-79'>#</a>
          </div>
          <p>a <strong> at the end will just swallow the rest.
We have found a match.
however, it will not swallow /.x, unless
options.dot is set.
. and .. are <em>never</em> matched by </strong>, for explosively
exponential reasons.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(;</span> <span class="nx">fi</span> <span class="o">&lt;</span> <span class="nx">fl</span><span class="p">;</span> <span class="nx">fi</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">[</span><span class="nx">fi</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nx">file</span><span class="p">[</span><span class="nx">fi</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;..&#39;</span> <span class="o">||</span>
            <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">dot</span> <span class="o">&amp;&amp;</span> <span class="nx">file</span><span class="p">[</span><span class="nx">fi</span><span class="p">].</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
      <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-80" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-80'>#</a>
          </div>
          <p>ok, let's see if we can swallow whatever we can.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">while</span> <span class="p">(</span><span class="nx">fr</span> <span class="o">&lt;</span> <span class="nx">fl</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">swallowee</span> <span class="o">=</span> <span class="nx">file</span><span class="p">[</span><span class="nx">fr</span><span class="p">]</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;\nglobstar while&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">fr</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">pr</span><span class="p">,</span> <span class="nx">swallowee</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-81" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-81'>#</a>
          </div>
          <p>XXX remove this slice.  Just pass the start index.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">matchOne</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">fr</span><span class="p">),</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">pr</span><span class="p">),</span> <span class="nx">partial</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;globstar found match!&#39;</span><span class="p">,</span> <span class="nx">fr</span><span class="p">,</span> <span class="nx">fl</span><span class="p">,</span> <span class="nx">swallowee</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-82" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-82'>#</a>
          </div>
          <p>found a match.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-83" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-83'>#</a>
          </div>
          <p>can't swallow "." or ".." ever.
can only swallow ".foo" when explicitly asked.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">swallowee</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nx">swallowee</span> <span class="o">===</span> <span class="s1">&#39;..&#39;</span> <span class="o">||</span>
            <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">dot</span> <span class="o">&amp;&amp;</span> <span class="nx">swallowee</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;dot detected!&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">fr</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">pr</span><span class="p">)</span>
            <span class="k">break</span>
          <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-84" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-84'>#</a>
          </div>
          <p>swallows a segment, and continue.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;globstar swallow a segment, and continue&#39;</span><span class="p">)</span>
          <span class="nx">fr</span><span class="o">++</span>
        <span class="p">}</span>
      <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-85" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-85'>#</a>
          </div>
          <p>no match was found.
However, in partial mode, we can't say this is necessarily over.
If there's more <em>pattern</em> left, then</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">partial</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-86" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-86'>#</a>
          </div>
          <p>ran out of file</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;\n&gt;&gt;&gt; no match, partial?&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">fr</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">pr</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">fr</span> <span class="o">===</span> <span class="nx">fl</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-87" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-87'>#</a>
          </div>
          <p>something other than **
non-magic patterns just have to match exactly
patterns with magic have been turned into regexps.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">hit</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">p</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">nocase</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">hit</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="nx">p</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">hit</span> <span class="o">=</span> <span class="nx">f</span> <span class="o">===</span> <span class="nx">p</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;string match&#39;</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">hit</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">hit</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s1">&#39;pattern match&#39;</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">hit</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hit</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-88" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-88'>#</a>
          </div>
          <p>Note: ending in / means that we'll get a final ""
at the end of the pattern.  This can only match a
corresponding "" at the end of the file.
If the file ends in /, then it can only match a
a pattern that ends in /, unless the pattern just
doesn't have any more for it. But, a/b/ should <em>not</em>
match "a/b/<em>", even though "" matches against the
[^/]</em>? pattern, except in partial mode, where it might
simply not be reached yet.
However, a/b/ should still satisfy a/*</p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-89" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-89'>#</a>
          </div>
          <p>now either we fell off the end of the pattern, or we're done.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">fi</span> <span class="o">===</span> <span class="nx">fl</span> <span class="o">&amp;&amp;</span> <span class="nx">pi</span> <span class="o">===</span> <span class="nx">pl</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-90" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-90'>#</a>
          </div>
          <p>ran out of pattern and filename at the same time.
an exact hit!</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">true</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">fi</span> <span class="o">===</span> <span class="nx">fl</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-91" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-91'>#</a>
          </div>
          <p>ran out of file, but still had pattern left.
this is ok if we're doing the match as part of
a glob fs traversal.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">partial</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pi</span> <span class="o">===</span> <span class="nx">pl</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-92" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-92'>#</a>
          </div>
          <p>ran out of pattern, still have file left.
this is only acceptable if we're on the very last
empty segment of a file with a trailing slash.
a/* should match a/b/</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">emptyFileEnd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">fi</span> <span class="o">===</span> <span class="nx">fl</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">file</span><span class="p">[</span><span class="nx">fi</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">emptyFileEnd</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-93" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-93'>#</a>
          </div>
          <p>should be unreachable.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;wtf?&#39;</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-94" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-94'>#</a>
          </div>
          <p>replace stuff like * with *</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">function</span> <span class="nx">globUnescape</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\(.)/g</span><span class="p">,</span> <span class="s1">&#39;$1&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">regExpEscape</span> <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[-[\]{}()*+?.,\\^$|#\s]/g</span><span class="p">,</span> <span class="s1">&#39;\\$&amp;&#39;</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
