<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/docco/node_modules/fs-extra/node_modules/rimraf/node_modules/glob/glob.js</title>
  <link rel="stylesheet" href="../../../../../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:19</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="glob.js.html/../../../../../../../../../index.html">.</a> / <a href="glob.js.html/../../../../../../../../index.html">node_modules</a> / <a href="glob.js.html/../../../../../../../index.html">docco</a> / <a href="glob.js.html/../../../../../../index.html">node_modules</a> / <a href="glob.js.html/../../../../../index.html">fs-extra</a> / <a href="glob.js.html/../../../../index.html">node_modules</a> / <a href="glob.js.html/../../../index.html">rimraf</a> / <a href="glob.js.html/../../index.html">node_modules</a> / <a href="glob.js.html/../index.html">glob</a> / glob.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          <p>Approach:</p>
<ol>
<li>Get the minimatch set</li>
<li>For each pattern in the set, PROCESS(pattern, false)</li>
<li>Store matches per-set, then uniq them</li>
</ol>
<p>PROCESS(pattern, inGlobStar)
Get the first [n] items from pattern that are all strings
Join these together.  This is PREFIX.
  If there is no more remaining, then stat(PREFIX) and
  add to matches if it succeeds.  END.</p>
<p>If inGlobStar and PREFIX is symlink and points to dir
  set ENTRIES = []
else readdir(PREFIX) as ENTRIES
  If fail, END</p>
<p>with ENTRIES
  If pattern[n] is GLOBSTAR
handle the case where the globstar match is empty
by pruning it out, and testing the resulting pattern
    PROCESS(pattern[0..n] + pattern[n+1 .. <script type="math/tex">], false)
handle other cases.
    for ENTRY in ENTRIES (not dotfiles)
attach globstar + tail onto the entry
Mark that this entry is a globstar match
      PROCESS(pattern[0..n] + ENTRY + pattern[n .. </script>], true)</p>
<p>else // not globstar
    for ENTRY in ENTRIES (not dotfiles, unless pattern[n] is dot)
      Test ENTRY against pattern[n]
      If fails, continue
      If passes, PROCESS(pattern[0..n] + item + pattern[n+1 .. $])</p>
<p>Caveat:
  Cache all stats and readdirs results to minimize syscall.  Since all
  we ever care about is existence and directory-ness, we can just keep
  <code>true</code> for files, and [children,...] for directories, or <code>false</code> for
  things that don't exist.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">glob</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">minimatch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;minimatch&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">Minimatch</span> <span class="o">=</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">Minimatch</span>
<span class="kd">var</span> <span class="nx">inherits</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;inherits&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">EE</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">).</span><span class="nx">EventEmitter</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">isAbsolute</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path-is-absolute&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">globSync</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./sync.js&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./common.js&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">alphasort</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">alphasort</span>
<span class="kd">var</span> <span class="nx">alphasorti</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">alphasorti</span>
<span class="kd">var</span> <span class="nx">setopts</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">setopts</span>
<span class="kd">var</span> <span class="nx">ownProp</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">ownProp</span>
<span class="kd">var</span> <span class="nx">inflight</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;inflight&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">childrenIgnored</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">childrenIgnored</span>
<span class="kd">var</span> <span class="nx">isIgnored</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">isIgnored</span>

<span class="kd">var</span> <span class="nx">once</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;once&#39;</span><span class="p">)</span>

<span class="kd">function</span> <span class="nx">glob</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="nx">cb</span> <span class="o">=</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;callback provided to sync glob&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">globSync</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">Glob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">glob</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="nx">globSync</span>
<span class="kd">var</span> <span class="nx">GlobSync</span> <span class="o">=</span> <span class="nx">glob</span><span class="p">.</span><span class="nx">GlobSync</span> <span class="o">=</span> <span class="nx">globSync</span><span class="p">.</span><span class="nx">GlobSync</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <p>old api surface</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">glob</span><span class="p">.</span><span class="nx">glob</span> <span class="o">=</span> <span class="nx">glob</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">glob</span><span class="p">.</span><span class="nx">hasMagic</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options_</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">_extend</span><span class="p">({},</span> <span class="nx">options_</span><span class="p">)</span>
  <span class="nx">options</span><span class="p">.</span><span class="nx">noprocess</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Glob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">set</span> <span class="o">=</span> <span class="nx">g</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">true</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">set</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">true</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">false</span>
<span class="p">}</span>

<span class="nx">glob</span><span class="p">.</span><span class="nx">Glob</span> <span class="o">=</span> <span class="nx">Glob</span>
<span class="nx">inherits</span><span class="p">(</span><span class="nx">Glob</span><span class="p">,</span> <span class="nx">EE</span><span class="p">)</span>
<span class="kd">function</span> <span class="nx">Glob</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cb</span> <span class="o">=</span> <span class="nx">options</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;callback provided to sync glob&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">GlobSync</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">))</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Glob</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

  <span class="nx">setopts</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_didRealPath</span> <span class="o">=</span> <span class="kc">false</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <p>process each pattern in the minimatch set</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          <p>The matches are stored as {<filename>: true,...} so that
duplicates are automagically pruned.
Later, we do an Object.keys() on these.
Keep them as a list so we can fill in when nonull is set.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">cb</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cb</span> <span class="o">=</span> <span class="nx">once</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">matches</span><span class="p">)</span>
    <span class="p">})</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_processing</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">noprocess</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">done</span><span class="p">()</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">done</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">done</span> <span class="p">()</span> <span class="p">{</span>
    <span class="o">--</span><span class="nx">self</span><span class="p">.</span><span class="nx">_processing</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">_processing</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_finish</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">realpath</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_didRealpath</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_realpath</span><span class="p">()</span>

  <span class="nx">common</span><span class="p">.</span><span class="nx">finish</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">found</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_realpath</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_didRealpath</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_didRealpath</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_finish</span><span class="p">()</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_realpathSet</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span>

  <span class="kd">function</span> <span class="nx">next</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_finish</span><span class="p">()</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_realpathSet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">matchset</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">matchset</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="kd">var</span> <span class="nx">found</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">matchset</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nx">found</span><span class="p">.</span><span class="nx">length</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="kd">var</span> <span class="nx">set</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          <p>If there's a problem with the stat, then it means that
one or more of the links in the realpath couldn't be
resolved.  just return the abs value in that case.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">found</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">p</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">fs</span><span class="p">.</span><span class="nx">realpath</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">realpathCache</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">real</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">er</span><span class="p">)</span>
        <span class="nx">set</span><span class="p">[</span><span class="nx">real</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">.</span><span class="nx">syscall</span> <span class="o">===</span> <span class="s1">&#39;stat&#39;</span><span class="p">)</span>
        <span class="nx">set</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="k">else</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span> <span class="c1">// srsly wtf right here</span>

      <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="nx">n</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">set</span>
        <span class="nx">cb</span><span class="p">()</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">})</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_mark</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">common</span><span class="p">.</span><span class="nx">mark</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_makeAbs</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">common</span><span class="p">.</span><span class="nx">makeAbs</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">abort</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">aborted</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;abort&#39;</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;pause&#39;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resume</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;resume&#39;</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">paused</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">eq</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">eq</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">eq</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_emitMatch</span><span class="p">(</span><span class="nx">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">pq</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">pq</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">pq</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_processing</span><span class="o">--</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">p</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_process</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Glob</span><span class="p">)</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">cb</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_processing</span><span class="o">++</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">])</span>
    <span class="k">return</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          <p>console.error('PROCESS %d', this._processing, pattern)</p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          <p>Get the first [n] parts of pattern that are all strings.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">++</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          <p>now n is the index of the first one that is <em>not</em> a string.</p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>see if there's anything else</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">prefix</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>if not, then this is rather simple</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">case</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span><span class="o">:</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_processSimple</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
      <span class="k">return</span>

    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>pattern <em>starts</em> with some non-trivial item.
going to readdir(cwd), but not include the prefix in matches.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">prefix</span> <span class="o">=</span> <span class="kc">null</span>
      <span class="k">break</span>

    <span class="k">default</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          <p>pattern has some string bits in the front.
whatever it starts with, whether that's 'absolute' like /foo/bar,
or 'relative' like '../baz'</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">remain</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>get the list of entries.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">read</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">||</span> <span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prefix</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">))</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">prefix</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="nx">prefix</span>
  <span class="p">}</span> <span class="k">else</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="nx">prefix</span>

  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">read</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          <p>if ignored, skip _processing</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">childrenIgnored</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">read</span><span class="p">))</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="kd">var</span> <span class="nx">isGlobStar</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">GLOBSTAR</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isGlobStar</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processGlobStar</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processReaddir</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processReaddir</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_processReaddir2</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          <p>if the abs isn't a dir, then nothing can match!</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processReaddir2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          <p>It will only match dot entries if it starts with a dot, or if
dot is set.  Stuff like @(.foo|.bar) isn't allowed.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">pn</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="kd">var</span> <span class="nx">negate</span> <span class="o">=</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">negate</span>
  <span class="kd">var</span> <span class="nx">rawGlob</span> <span class="o">=</span> <span class="nx">pn</span><span class="p">.</span><span class="nx">_glob</span>
  <span class="kd">var</span> <span class="nx">dotOk</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dot</span> <span class="o">||</span> <span class="nx">rawGlob</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span>

  <span class="kd">var</span> <span class="nx">matchedEntries</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nx">dotOk</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">negate</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">m</span> <span class="o">=</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pn</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">m</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pn</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span>
        <span class="nx">matchedEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          <p>console.error('prd2', prefix, entries, remain[0]._glob, matchedEntries)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">matchedEntries</span><span class="p">.</span><span class="nx">length</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>If there are no matched entries, then nothing matches.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          <p>if this is the last remaining pattern bit, then no need for
an additional stat <em>unless</em> the user has specified mark or
stat explicitly.  We know they exist, since readdir returned
them.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">remain</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">matchedEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">e</span>
        <span class="k">else</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nomount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_emitMatch</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-31" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-31'>#</a>
          </div>
          <p>This was the last one, and no stats were needed</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-32" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-32'>#</a>
          </div>
          <p>now test all matched entries as stand-ins for that part
of the pattern.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">remain</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">matchedEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nx">newPattern</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="k">else</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">e</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">([</span><span class="nx">e</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">remain</span><span class="p">),</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="nx">cb</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-33" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-33'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_emitMatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">e</span><span class="p">])</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">isIgnored</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">e</span><span class="p">))</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_emitQueue</span><span class="p">.</span><span class="nx">push</span><span class="p">([</span><span class="nx">index</span><span class="p">,</span> <span class="nx">e</span><span class="p">])</span>
    <span class="k">return</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nodir</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;DIR&#39;</span> <span class="o">||</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
      <span class="k">return</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span><span class="p">)</span>
    <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mark</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>

  <span class="kd">var</span> <span class="nx">st</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">st</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">st</span><span class="p">)</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;match&#39;</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-34" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-34'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdirInGlobStar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-35" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-35'>#</a>
          </div>
          <p>follow all symlinked directories forever
just proceed as if this is a non-globstar situation</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">follow</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">lstatkey</span> <span class="o">=</span> <span class="s1">&#39;lstat\0&#39;</span> <span class="o">+</span> <span class="nx">abs</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
  <span class="kd">var</span> <span class="nx">lstatcb</span> <span class="o">=</span> <span class="nx">inflight</span><span class="p">(</span><span class="nx">lstatkey</span><span class="p">,</span> <span class="nx">lstatcb_</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">lstatcb</span><span class="p">)</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">lstatcb</span><span class="p">)</span>

  <span class="kd">function</span> <span class="nx">lstatcb_</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">lstat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

    <span class="kd">var</span> <span class="nx">isSym</span> <span class="o">=</span> <span class="nx">lstat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">()</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">symlinks</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">isSym</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-36" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-36'>#</a>
          </div>
          <p>If it's not a symlink or a dir, then it's definitely a regular file.
don't bother doing a readdir in that case.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isSym</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">lstat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FILE&#39;</span>
      <span class="nx">cb</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-37" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-37'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdir</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="nx">cb</span> <span class="o">=</span> <span class="nx">inflight</span><span class="p">(</span><span class="s1">&#39;readdir\0&#39;</span><span class="o">+</span><span class="nx">abs</span><span class="o">+</span><span class="s1">&#39;\0&#39;</span><span class="o">+</span><span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">cb</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-38" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-38'>#</a>
          </div>
          <p>console.error('RD %j %j', +inGlobStar, abs)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">inGlobStar</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">ownProp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">symlinks</span><span class="p">,</span> <span class="nx">abs</span><span class="p">))</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdirInGlobStar</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">ownProp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">,</span> <span class="nx">abs</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;FILE&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">readdirCb</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">readdirCb</span> <span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-39" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-39'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_readdirError</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_readdirEntries</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-40" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-40'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdirEntries</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-41" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-41'>#</a>
          </div>
          <p>if we haven't asked to stat everything, then just
assume that everything in there exists, so we can avoid
having to stat it a second time.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">abs</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">abs</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="k">else</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">abs</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entries</span>
  <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-42" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-42'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdirError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">aborted</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-43" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-43'>#</a>
          </div>
          <p>handle errors, and cache the information</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">switch</span> <span class="p">(</span><span class="nx">er</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;ENOTSUP&#39;</span><span class="o">:</span> <span class="c1">// https://github.com/isaacs/node-glob/issues/205</span>
    <span class="k">case</span> <span class="s1">&#39;ENOTDIR&#39;</span><span class="o">:</span> <span class="c1">// totally normal. means it *does* exist.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;FILE&#39;</span>
      <span class="k">break</span>

    <span class="k">case</span> <span class="s1">&#39;ENOENT&#39;</span><span class="o">:</span> <span class="c1">// not terribly unusual</span>
    <span class="k">case</span> <span class="s1">&#39;ELOOP&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s1">&#39;ENAMETOOLONG&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s1">&#39;UNKNOWN&#39;</span><span class="o">:</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">break</span>

    <span class="k">default</span><span class="o">:</span> <span class="c1">// some unusual error.  Treat as failure.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">strict</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-44" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-44'>#</a>
          </div>
          <p>If the error is handled, then we abort
if not, we threw out of here</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">abort</span><span class="p">()</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;glob error&#39;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-45" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-45'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processGlobStar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">_processGlobStar2</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-46" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-46'>#</a>
          </div>
          <p>console.error('pgs2', prefix, remain[0], entries)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processGlobStar2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">,</span> <span class="nx">entries</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-47" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-47'>#</a>
          </div>
          <p>no entries means not a dir, so it can never have matches
foo.txt/** doesn't match foo.txt</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entries</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-48" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-48'>#</a>
          </div>
          <p>test without the globstar, and with every child both below
and replacing the globstar.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">remainWithoutGlobStar</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">gspref</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">?</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">]</span> <span class="o">:</span> <span class="p">[]</span>
  <span class="kd">var</span> <span class="nx">noGlobStar</span> <span class="o">=</span> <span class="nx">gspref</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">remainWithoutGlobStar</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-49" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-49'>#</a>
          </div>
          <p>the noGlobStar pattern exits the inGlobStar state</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">noGlobStar</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">isSym</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">symlinks</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-50" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-50'>#</a>
          </div>
          <p>If it's a symlink, and we're in a globstar, then stop</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">isSym</span> <span class="o">&amp;&amp;</span> <span class="nx">inGlobStar</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">dot</span><span class="p">)</span>
      <span class="k">continue</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-51" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-51'>#</a>
          </div>
          <p>these two cases enter the inGlobStar state</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">instead</span> <span class="o">=</span> <span class="nx">gspref</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">remainWithoutGlobStar</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">instead</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">below</span> <span class="o">=</span> <span class="nx">gspref</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">remain</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">below</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="nx">cb</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-52" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-52'>#</a>
          </div>
          <p>XXX review this.  Shouldn't it be doing the mounting etc
before doing stat?  kinda weird?</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processSimple</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-53" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-53'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">_stat</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">_processSimple2</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">exists</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-54" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-54'>#</a>
          </div>
          <p>console.error('ps2', prefix, exists)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processSimple2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">exists</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-55" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-55'>#</a>
          </div>
          <p>If it doesn't exist, then just mark the lack of results</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">&amp;&amp;</span> <span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nomount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">trail</span> <span class="o">=</span> <span class="sr">/[\/\\]$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">trail</span><span class="p">)</span>
        <span class="nx">prefix</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s1">&#39;win32&#39;</span><span class="p">)</span>
    <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-56" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-56'>#</a>
          </div>
          <p>Mark this as a match</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">_emitMatch</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
  <span class="nx">cb</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-57" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-57'>#</a>
          </div>
          <p>Returns either 'DIR', 'FILE', or false</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_stat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">needDir</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span> <span class="o">&amp;&amp;</span> <span class="nx">ownProp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">,</span> <span class="nx">abs</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="s1">&#39;DIR&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-58" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-58'>#</a>
          </div>
          <p>It exists, but maybe not how we need it</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">needDir</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;DIR&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">needDir</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;FILE&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-59" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-59'>#</a>
          </div>
          <p>otherwise we have to stat, because maybe c=true
if we know it exists, but not what it is.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">exists</span>
  <span class="kd">var</span> <span class="nx">stat</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">stat</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">type</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;DIR&#39;</span> <span class="o">:</span> <span class="s1">&#39;FILE&#39;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">needDir</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;FILE&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>
  <span class="kd">var</span> <span class="nx">statcb</span> <span class="o">=</span> <span class="nx">inflight</span><span class="p">(</span><span class="s1">&#39;stat\0&#39;</span> <span class="o">+</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">lstatcb_</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">statcb</span><span class="p">)</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">statcb</span><span class="p">)</span>

  <span class="kd">function</span> <span class="nx">lstatcb_</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">lstat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lstat</span> <span class="o">&amp;&amp;</span> <span class="nx">lstat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">())</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-60" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-60'>#</a>
          </div>
          <p>If it's a symlink, then treat it as the target, unless
the target does not exist, then treat it as a file.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">er</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">_stat2</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">lstat</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">_stat2</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">stat</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
      <span class="p">})</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">_stat2</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">lstat</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-61" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-61'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">Glob</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_stat2</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">er</span><span class="p">,</span> <span class="nx">stat</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">needDir</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stat</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">abs</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;DIR&#39;</span> <span class="o">:</span> <span class="s1">&#39;FILE&#39;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">||</span> <span class="nx">c</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">needDir</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">!==</span> <span class="s1">&#39;DIR&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">()</span>

  <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
