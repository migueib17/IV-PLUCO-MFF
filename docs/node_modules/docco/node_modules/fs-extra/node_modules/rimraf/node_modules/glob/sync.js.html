<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/docco/node_modules/fs-extra/node_modules/rimraf/node_modules/glob/sync.js</title>
  <link rel="stylesheet" href="../../../../../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:19</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="sync.js.html/../../../../../../../../../index.html">.</a> / <a href="sync.js.html/../../../../../../../../index.html">node_modules</a> / <a href="sync.js.html/../../../../../../../index.html">docco</a> / <a href="sync.js.html/../../../../../../index.html">node_modules</a> / <a href="sync.js.html/../../../../../index.html">fs-extra</a> / <a href="sync.js.html/../../../../index.html">node_modules</a> / <a href="sync.js.html/../../../index.html">rimraf</a> / <a href="sync.js.html/../../index.html">node_modules</a> / <a href="sync.js.html/../index.html">glob</a> / sync.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">globSync</span>
<span class="nx">globSync</span><span class="p">.</span><span class="nx">GlobSync</span> <span class="o">=</span> <span class="nx">GlobSync</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">minimatch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;minimatch&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">Minimatch</span> <span class="o">=</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">Minimatch</span>
<span class="kd">var</span> <span class="nx">Glob</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./glob.js&#39;</span><span class="p">).</span><span class="nx">Glob</span>
<span class="kd">var</span> <span class="nx">util</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;util&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;assert&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">isAbsolute</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path-is-absolute&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">common</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./common.js&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">alphasort</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">alphasort</span>
<span class="kd">var</span> <span class="nx">alphasorti</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">alphasorti</span>
<span class="kd">var</span> <span class="nx">setopts</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">setopts</span>
<span class="kd">var</span> <span class="nx">ownProp</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">ownProp</span>
<span class="kd">var</span> <span class="nx">childrenIgnored</span> <span class="o">=</span> <span class="nx">common</span><span class="p">.</span><span class="nx">childrenIgnored</span>

<span class="kd">function</span> <span class="nx">globSync</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">||</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;callback provided to sync glob\n&#39;</span><span class="o">+</span>
                        <span class="s1">&#39;See: https://github.com/isaacs/node-glob/issues/167&#39;</span><span class="p">)</span>

  <span class="k">return</span> <span class="k">new</span> <span class="nx">GlobSync</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">).</span><span class="nx">found</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">GlobSync</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">pattern</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;must provide pattern&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">||</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;callback provided to sync glob\n&#39;</span><span class="o">+</span>
                        <span class="s1">&#39;See: https://github.com/isaacs/node-glob/issues/167&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">GlobSync</span><span class="p">))</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">GlobSync</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

  <span class="nx">setopts</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">noprocess</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span>

  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">.</span><span class="nx">length</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">set</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">i</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_finish</span><span class="p">()</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_finish</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">GlobSync</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">realpath</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">matchset</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">set</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">matchset</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">p</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span>
          <span class="kd">var</span> <span class="nx">real</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">realpathSync</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">realpathCache</span><span class="p">)</span>
          <span class="nx">set</span><span class="p">[</span><span class="nx">real</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">er</span><span class="p">.</span><span class="nx">syscall</span> <span class="o">===</span> <span class="s1">&#39;stat&#39;</span><span class="p">)</span>
            <span class="nx">set</span><span class="p">[</span><span class="nx">self</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">p</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">true</span>
          <span class="k">else</span>
            <span class="k">throw</span> <span class="nx">er</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
  <span class="nx">common</span><span class="p">.</span><span class="nx">finish</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_process</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">assert</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">GlobSync</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <p>Get the first [n] parts of pattern that are all strings.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">n</span> <span class="o">++</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          <p>now n is the index of the first one that is <em>not</em> a string.</p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          <p>See if there's anything else</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">prefix</span>
  <span class="k">switch</span> <span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          <p>if not, then this is rather simple</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">case</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">length</span><span class="o">:</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_processSimple</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">),</span> <span class="nx">index</span><span class="p">)</span>
      <span class="k">return</span>

    <span class="k">case</span> <span class="mi">0</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          <p>pattern <em>starts</em> with some non-trivial item.
going to readdir(cwd), but not include the prefix in matches.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">prefix</span> <span class="o">=</span> <span class="kc">null</span>
      <span class="k">break</span>

    <span class="k">default</span><span class="o">:</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          <p>pattern has some string bits in the front.
whatever it starts with, whether that's 'absolute' like /foo/bar,
or 'relative' like '../baz'</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">n</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">remain</span> <span class="o">=</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          <p>get the list of entries.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">read</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">||</span> <span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">pattern</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prefix</span> <span class="o">||</span> <span class="o">!</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">))</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">prefix</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="nx">prefix</span>
  <span class="p">}</span> <span class="k">else</span>
    <span class="nx">read</span> <span class="o">=</span> <span class="nx">prefix</span>

  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">read</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          <p>if ignored, skip processing</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">childrenIgnored</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">read</span><span class="p">))</span>
    <span class="k">return</span>

  <span class="kd">var</span> <span class="nx">isGlobStar</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">minimatch</span><span class="p">.</span><span class="nx">GLOBSTAR</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">isGlobStar</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processGlobStar</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span>
  <span class="k">else</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_processReaddir</span><span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processReaddir</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          <p>if the abs isn't a dir, then nothing can match!</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entries</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          <p>It will only match dot entries if it starts with a dot, or if
dot is set.  Stuff like @(.foo|.bar) isn't allowed.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">pn</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="kd">var</span> <span class="nx">negate</span> <span class="o">=</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">minimatch</span><span class="p">.</span><span class="nx">negate</span>
  <span class="kd">var</span> <span class="nx">rawGlob</span> <span class="o">=</span> <span class="nx">pn</span><span class="p">.</span><span class="nx">_glob</span>
  <span class="kd">var</span> <span class="nx">dotOk</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">dot</span> <span class="o">||</span> <span class="nx">rawGlob</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span>

  <span class="kd">var</span> <span class="nx">matchedEntries</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nx">dotOk</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">m</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">negate</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">m</span> <span class="o">=</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pn</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">m</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">pn</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span>
        <span class="nx">matchedEntries</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">matchedEntries</span><span class="p">.</span><span class="nx">length</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          <p>If there are no matched entries, then nothing matches.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          <p>if this is the last remaining pattern bit, then no need for
an additional stat <em>unless</em> the user has specified mark or
stat explicitly.  We know they exist, since readdir returned
them.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">remain</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">matchedEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">e</span>
        <span class="k">else</span>
          <span class="nx">e</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nomount</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          <p>This was the last one, and no stats were needed</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          <p>now test all matched entries as stand-ins for that part
of the pattern.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">remain</span><span class="p">.</span><span class="nx">shift</span><span class="p">()</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">matchedEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="kd">var</span> <span class="nx">newPattern</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span>
      <span class="nx">newPattern</span> <span class="o">=</span> <span class="p">[</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">e</span><span class="p">]</span>
    <span class="k">else</span>
      <span class="nx">newPattern</span> <span class="o">=</span> <span class="p">[</span><span class="nx">e</span><span class="p">]</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">newPattern</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">remain</span><span class="p">),</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_emitMatch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span><span class="p">)</span>
    <span class="nx">e</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_mark</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">e</span><span class="p">])</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">nodir</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">e</span><span class="p">)]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;DIR&#39;</span> <span class="o">||</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
      <span class="k">return</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_stat</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>follow all symlinked directories forever
just proceed as if this is a non-globstar situation</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdirInGlobStar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">abs</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">follow</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">entries</span>
  <span class="kd">var</span> <span class="nx">lstat</span>
  <span class="kd">var</span> <span class="nx">stat</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">lstat</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstatSync</span><span class="p">(</span><span class="nx">abs</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>lstat failed, doesn't exist</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="kc">null</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">isSym</span> <span class="o">=</span> <span class="nx">lstat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">()</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">symlinks</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">isSym</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>If it's not a symlink or a dir, then it's definitely a regular file.
don't bother doing a readdir in that case.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isSym</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">lstat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;FILE&#39;</span>
  <span class="k">else</span>
    <span class="nx">entries</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>

  <span class="k">return</span> <span class="nx">entries</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdir</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">entries</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">inGlobStar</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">ownProp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">symlinks</span><span class="p">,</span> <span class="nx">abs</span><span class="p">))</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdirInGlobStar</span><span class="p">(</span><span class="nx">abs</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">ownProp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">,</span> <span class="nx">abs</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;FILE&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">null</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
      <span class="k">return</span> <span class="nx">c</span>
  <span class="p">}</span>

  <span class="k">try</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdirEntries</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readdirSync</span><span class="p">(</span><span class="nx">abs</span><span class="p">))</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_readdirError</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">null</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>if we haven't asked to stat everything, then just
assume that everything in there exists, so we can avoid
having to stat it a second time.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdirEntries</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">mark</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">abs</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">abs</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="k">else</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">abs</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">e</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">e</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">entries</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          <p>mark and cache dir-ness</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">return</span> <span class="nx">entries</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          <p>handle errors, and cache the information</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_readdirError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">switch</span> <span class="p">(</span><span class="nx">er</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;ENOTSUP&#39;</span><span class="o">:</span> <span class="c1">// https://github.com/isaacs/node-glob/issues/205</span>
    <span class="k">case</span> <span class="s1">&#39;ENOTDIR&#39;</span><span class="o">:</span> <span class="c1">// totally normal. means it *does* exist.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;FILE&#39;</span>
      <span class="k">break</span>

    <span class="k">case</span> <span class="s1">&#39;ENOENT&#39;</span><span class="o">:</span> <span class="c1">// not terribly unusual</span>
    <span class="k">case</span> <span class="s1">&#39;ELOOP&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s1">&#39;ENAMETOOLONG&#39;</span><span class="o">:</span>
    <span class="k">case</span> <span class="s1">&#39;UNKNOWN&#39;</span><span class="o">:</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">break</span>

    <span class="k">default</span><span class="o">:</span> <span class="c1">// some unusual error.  Treat as failure.</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">strict</span><span class="p">)</span>
        <span class="k">throw</span> <span class="nx">er</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;glob error&#39;</span><span class="p">,</span> <span class="nx">er</span><span class="p">)</span>
      <span class="k">break</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processGlobStar</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">read</span><span class="p">,</span> <span class="nx">abs</span><span class="p">,</span> <span class="nx">remain</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">entries</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_readdir</span><span class="p">(</span><span class="nx">abs</span><span class="p">,</span> <span class="nx">inGlobStar</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          <p>no entries means not a dir, so it can never have matches
foo.txt/** doesn't match foo.txt</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">entries</span><span class="p">)</span>
    <span class="k">return</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          <p>test without the globstar, and with every child both below
and replacing the globstar.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">remainWithoutGlobStar</span> <span class="o">=</span> <span class="nx">remain</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">gspref</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">?</span> <span class="p">[</span> <span class="nx">prefix</span> <span class="p">]</span> <span class="o">:</span> <span class="p">[]</span>
  <span class="kd">var</span> <span class="nx">noGlobStar</span> <span class="o">=</span> <span class="nx">gspref</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">remainWithoutGlobStar</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>the noGlobStar pattern exits the inGlobStar state</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">noGlobStar</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">false</span><span class="p">)</span>

  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">.</span><span class="nx">length</span>
  <span class="kd">var</span> <span class="nx">isSym</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">symlinks</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          <p>If it's a symlink, and we're in a globstar, then stop</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="nx">isSym</span> <span class="o">&amp;&amp;</span> <span class="nx">inGlobStar</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">dot</span><span class="p">)</span>
      <span class="k">continue</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-31" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-31'>#</a>
          </div>
          <p>these two cases enter the inGlobStar state</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">instead</span> <span class="o">=</span> <span class="nx">gspref</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">remainWithoutGlobStar</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">instead</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>

    <span class="kd">var</span> <span class="nx">below</span> <span class="o">=</span> <span class="nx">gspref</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">entries</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">remain</span><span class="p">)</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_process</span><span class="p">(</span><span class="nx">below</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-32" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-32'>#</a>
          </div>
          <p>XXX review this.  Shouldn't it be doing the mounting etc
before doing stat?  kinda weird?</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_processSimple</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">var</span> <span class="nx">exists</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stat</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-33" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-33'>#</a>
          </div>
          <p>If it doesn't exist, then just mark the lack of results</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span>
    <span class="k">return</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span> <span class="o">&amp;&amp;</span> <span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">nomount</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">trail</span> <span class="o">=</span> <span class="sr">/[\/\\]$/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">prefix</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">root</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">trail</span><span class="p">)</span>
        <span class="nx">prefix</span> <span class="o">+=</span> <span class="s1">&#39;/&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">platform</span> <span class="o">===</span> <span class="s1">&#39;win32&#39;</span><span class="p">)</span>
    <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-34" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-34'>#</a>
          </div>
          <p>Mark this as a match</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">matches</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="nx">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-35" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-35'>#</a>
          </div>
          <p>Returns either 'DIR', 'FILE', or false</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_stat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">abs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_makeAbs</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
  <span class="kd">var</span> <span class="nx">needDir</span> <span class="o">=</span> <span class="nx">f</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;/&#39;</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">f</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">maxLength</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stat</span> <span class="o">&amp;&amp;</span> <span class="nx">ownProp</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">,</span> <span class="nx">abs</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">c</span><span class="p">))</span>
      <span class="nx">c</span> <span class="o">=</span> <span class="s1">&#39;DIR&#39;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-36" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-36'>#</a>
          </div>
          <p>It exists, but maybe not how we need it</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">needDir</span> <span class="o">||</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;DIR&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">c</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">needDir</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">===</span> <span class="s1">&#39;FILE&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="kc">false</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-37" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-37'>#</a>
          </div>
          <p>otherwise we have to stat, because maybe c=true
if we know it exists, but not what it is.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">exists</span>
  <span class="kd">var</span> <span class="nx">stat</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lstat</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="nx">lstat</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstatSync</span><span class="p">(</span><span class="nx">abs</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">lstat</span><span class="p">.</span><span class="nx">isSymbolicLink</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">try</span> <span class="p">{</span>
        <span class="nx">stat</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statSync</span><span class="p">(</span><span class="nx">abs</span><span class="p">)</span>
      <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">er</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">stat</span> <span class="o">=</span> <span class="nx">lstat</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">stat</span> <span class="o">=</span> <span class="nx">lstat</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">statCache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stat</span>

  <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">stat</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">()</span> <span class="o">?</span> <span class="s1">&#39;DIR&#39;</span> <span class="o">:</span> <span class="s1">&#39;FILE&#39;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">abs</span><span class="p">]</span> <span class="o">||</span> <span class="nx">c</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">needDir</span> <span class="o">&amp;&amp;</span> <span class="nx">c</span> <span class="o">!==</span> <span class="s1">&#39;DIR&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">false</span>

  <span class="k">return</span> <span class="nx">c</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-38" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-38'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_mark</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">common</span><span class="p">.</span><span class="nx">mark</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span>
<span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-39" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-39'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">GlobSync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_makeAbs</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">common</span><span class="p">.</span><span class="nx">makeAbs</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">f</span><span class="p">)</span>
<span class="p">}</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
