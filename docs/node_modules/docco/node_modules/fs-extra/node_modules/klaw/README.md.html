<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/docco/node_modules/fs-extra/node_modules/klaw/README.md</title>
  <link rel="stylesheet" href="../../../../../../pyccoon.css">
</head>
<body>
<div id='container' class="documentation">
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div id="jump_to" class="btn">
    Contents
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source source-3" href="#klaw(directory,-[options])"> klaw(directory, [options])</a>
          <a class="source source-3" href="#error-handling"> Error Handling</a>
          <a class="source source-3" href="#aggregation-/-filtering-/-executing-actions-(through-streams)"> Aggregation / Filtering / Executing Actions (Through Streams)</a>
          <a class="source source-3" href="#searching-strategy"> Searching Strategy</a>
      </div>
    </div>
    </div>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:19</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="README.md.html/../../../../../../../index.html">.</a> / <a href="README.md.html/../../../../../../index.html">node_modules</a> / <a href="README.md.html/../../../../../index.html">docco</a> / <a href="README.md.html/../../../../index.html">node_modules</a> / <a href="README.md.html/../../../index.html">fs-extra</a> / <a href="README.md.html/../../index.html">node_modules</a> / <a href="README.md.html/../index.html">klaw</a> / README.md</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          <h1>Node.js - klaw</h1>
<p>A Node.js file system walker extracted from <a href="https://github.com/jprichardson/node-fs-extra">fs-extra</a>.</p>
<p><a href="http://travis-ci.org/jprichardson/node-klaw"><img alt="build status" src="https://api.travis-ci.org/jprichardson/node-klaw.svg" /></a>
<a href="https://ci.appveyor.com/project/jprichardson/node-klaw/branch/master"><img alt="windows build status" src="https://ci.appveyor.com/api/projects/status/github/jprichardson/node-klaw?branch=master&amp;svg=true" /></a></p>
<h2>Install</h2>
<div class="codehilite"><pre>npm i --save klaw
</pre></div>


<h2>Name</h2>
<p><code>klaw</code> is <code>walk</code> backwards :p</p>
<h2>Usage</h2>
<h3><a id="klaw(directory,-[options])" class="header-anchor" href="#klaw(directory,-[options])"> klaw(directory, [options])</a></h3>
<p>Returns a <a href="https://nodejs.org/api/stream.html#stream_class_stream_readable">Readable stream</a> that iterates
through every file and directory starting with <code>dir</code> as the root. Every <code>read()</code> or <code>data</code> event
returns an object with two properties: <code>path</code> and <code>stats</code>. <code>path</code> is the full path of the file and
<code>stats</code> is an instance of <a href="https://nodejs.org/api/fs.html#fs_class_fs_stats">fs.Stats</a>.</p>
<ul>
<li><code>directory</code>: The directory to recursively walk. Type <code>string</code>.</li>
<li><code>options</code>: <a href="https://nodejs.org/api/stream.html#stream_new_stream_readable_options">Readable stream options</a> and
the following:</li>
<li><code>queueMethod</code>: Either <code>'shift'</code> or <code>'pop'</code>. Type <code>string</code>.</li>
<li><code>pathSorter</code>: Sorting <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">function for Arrays</a>. Type <code>function</code>.</li>
</ul>
<p><strong>Streams 1 (push) example:</strong></p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">klaw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;klaw&#39;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">// files, directories, symlinks, etc</span>
<span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="c1">// =&gt; [ ... array of files]</span>
  <span class="p">})</span>
</pre></div>


<p><strong>Streams 2 &amp; 3 (pull) example:</strong></p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">klaw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;klaw&#39;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">// files, directories, symlinks, etc</span>
<span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;readable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span>
    <span class="k">while</span> <span class="p">((</span><span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">read</span><span class="p">()))</span> <span class="p">{</span>
      <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="c1">// =&gt; [ ... array of files]</span>
  <span class="p">})</span>
</pre></div>


<p>If you're not sure of the differences on Node.js streams 1, 2, 3 then I'd
recommend this resource as a good starting point: <a href="https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/.">https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/.</a></p>
<h3><a id="error-handling" class="header-anchor" href="#error-handling"> Error Handling</a></h3>
<p>Listen for the <code>error</code> event.</p>
<p>Example:</p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">klaw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;klaw&#39;</span><span class="p">)</span>
<span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;readable&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">item</span>
    <span class="k">while</span> <span class="p">((</span><span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">read</span><span class="p">()))</span> <span class="p">{</span>
      <span class="c1">// do something with the file</span>
    <span class="p">}</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="c1">// the file the error occurred on</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="c1">// =&gt; [ ... array of files]</span>
  <span class="p">})</span>
</pre></div>


<h3><a id="aggregation-/-filtering-/-executing-actions-(through-streams)" class="header-anchor" href="#aggregation-/-filtering-/-executing-actions-(through-streams)"> Aggregation / Filtering / Executing Actions (Through Streams)</a></h3>
<p>On many occasions you may want to filter files based upon size, extension, etc.
Or you may want to aggregate stats on certain file types. Or maybe you want to
perform an action on certain file types.</p>
<p>You should use the module <a href="https://www.npmjs.com/package/through2"><code>through2</code></a> to easily
accomplish this.</p>
<p>Install <code>through2</code>:</p>
<div class="codehilite"><pre>npm i --save through2
</pre></div>


<p><strong>Example (skipping directories):</strong></p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">klaw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;klaw&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">through2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;through2&#39;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">excludeDirFilter</span> <span class="o">=</span> <span class="nx">through2</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">enc</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span> <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
  <span class="nx">next</span><span class="p">()</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">// files, directories, symlinks, etc</span>
<span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">excludeDirFilter</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="c1">// =&gt; [ ... array of files without directories]</span>
  <span class="p">})</span>
</pre></div>


<p><strong>Example (totaling size of PNG files):</strong></p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">klaw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;klaw&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">through2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;through2&#39;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">totalPngsInBytes</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kd">var</span> <span class="nx">aggregatePngSize</span> <span class="o">=</span> <span class="nx">through2</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">enc</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;png&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">totalPngsInBytes</span> <span class="o">+=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>
  <span class="nx">next</span><span class="p">()</span>
<span class="p">})</span>

<span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">excludeDirFilter</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">totalPngsInBytes</span><span class="p">)</span> <span class="c1">// =&gt; total of all pngs (bytes)</span>
  <span class="p">})</span>
</pre></div>


<p><strong>Example (deleting all .tmp files):</strong></p>
<div class="codehilite"><pre><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">klaw</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;klaw&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">through2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;through2&#39;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">deleteAction</span> <span class="o">=</span> <span class="nx">through2</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">enc</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">deleted</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">unklink</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">deleted</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">next</span><span class="p">()</span>
  <span class="p">}</span>  
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">deletedFiles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">deleteAction</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">deleted</span><span class="p">)</span> <span class="k">return</span>
    <span class="nx">deletedFiles</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">dir</span><span class="p">(</span><span class="nx">deletedFiles</span><span class="p">)</span> <span class="c1">// =&gt; all deleted files</span>
  <span class="p">})</span>
</pre></div>


<p>You can even chain a bunch of these filters and aggregators together. By using
multiple pipes.</p>
<p><strong>Example (using multiple filters / aggregators):</strong></p>
<div class="codehilite"><pre><span class="nx">klaw</span><span class="p">(</span><span class="s1">&#39;/some/dir&#39;</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">filterCertainFiles</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">deleteSomeOtherFiles</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;all done!&#39;</span><span class="p">)</span>
  <span class="p">})</span>
</pre></div>


<h3><a id="searching-strategy" class="header-anchor" href="#searching-strategy"> Searching Strategy</a></h3>
<p>Pass in options for <code>queueMethod</code> and <code>pathSorter</code> to affect how the file system
is recursively iterated. See the code for more details, it's less than 50 lines :)</p>
<h2>License</h2>
<p>MIT</p>
<p>Copyright (c) 2015 <a href="https://github.com/jprichardson">JP Richardson</a></p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
