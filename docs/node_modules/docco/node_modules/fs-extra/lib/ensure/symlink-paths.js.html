<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/docco/node_modules/fs-extra/lib/ensure/symlink-paths.js</title>
  <link rel="stylesheet" href="../../../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:19</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="symlink-paths.js.html/../../../../../../../index.html">.</a> / <a href="symlink-paths.js.html/../../../../../../index.html">node_modules</a> / <a href="symlink-paths.js.html/../../../../../index.html">docco</a> / <a href="symlink-paths.js.html/../../../../index.html">node_modules</a> / <a href="symlink-paths.js.html/../../../index.html">fs-extra</a> / <a href="symlink-paths.js.html/../../index.html">lib</a> / <a href="symlink-paths.js.html/../index.html">ensure</a> / symlink-paths.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <p>path.isAbsolute shim for Node.js 0.10 support</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span> <span class="o">=</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span><span class="p">)</span> <span class="o">?</span> <span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span> <span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path-is-absolute&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;graceful-fs&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <p>Function that returns two types of paths, one relative to symlink, and one
 relative to the current working directory. Checks if path is absolute or
 relative. If the path is relative, this function checks if the path is
 relative to symlink or relative to current working directory. This is an
 initiative to find a smarter <code>srcpath</code> to supply when building symlinks.
 This allows you to determine which path to use out of one of three possible
 types of source paths. The first is an absolute path. This is detected by
 <code>path.isAbsolute()</code>. When an absolute path is provided, it is checked to
 see if it exists. If it does it's used, if not an error is returned
 (callback)/ thrown (sync). The other two options for <code>srcpath</code> are a
 relative url. By default Node's <code>fs.symlink</code> works by creating a symlink
 using <code>dstpath</code> and expects the <code>srcpath</code> to be relative to the newly
 created symlink. If you provide a <code>srcpath</code> that does not exist on the file
 system it results in a broken symlink. To minimize this, the function
 checks to see if the 'relative to symlink' source file exists, and if it
 does it will use it. If it does not, it checks if there's a file that
 exists that is relative to the current working directory, if does its used.
 This preserves the expectations of the original fs.symlink spec and adds
 the ability to pass in <code>relative to current working direcotry</code> paths.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="kd">function</span> <span class="nx">symlinkPaths</span> <span class="p">(</span><span class="nx">srcpath</span><span class="p">,</span> <span class="nx">dstpath</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">srcpath</span><span class="p">))</span> <span class="p">{</span>

    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">srcpath</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;lstat&#39;</span><span class="p">,</span> <span class="s1">&#39;ensureSymlink&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;toCwd&#39;</span><span class="o">:</span> <span class="nx">srcpath</span><span class="p">,</span>
        <span class="s1">&#39;toDst&#39;</span><span class="o">:</span> <span class="nx">srcpath</span>
      <span class="p">})</span>
    <span class="p">})</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dstdir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">dstpath</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">relativeToDst</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dstdir</span><span class="p">,</span> <span class="nx">srcpath</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">relativeToDst</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
          <span class="s1">&#39;toCwd&#39;</span><span class="o">:</span> <span class="nx">relativeToDst</span><span class="p">,</span>
          <span class="s1">&#39;toDst&#39;</span><span class="o">:</span> <span class="nx">srcpath</span>
        <span class="p">})</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">lstat</span><span class="p">(</span><span class="nx">srcpath</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stat</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">err</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span> <span class="nx">err</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;lstat&#39;</span><span class="p">,</span> <span class="s1">&#39;ensureSymlink&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;toCwd&#39;</span><span class="o">:</span> <span class="nx">srcpath</span><span class="p">,</span>
            <span class="s1">&#39;toDst&#39;</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">dstdir</span><span class="p">,</span> <span class="nx">srcpath</span><span class="p">)</span>
          <span class="p">})</span>
        <span class="p">})</span>
      <span class="p">}</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">symlinkPathsSync</span> <span class="p">(</span><span class="nx">srcpath</span><span class="p">,</span> <span class="nx">dstpath</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">exists</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">isAbsolute</span><span class="p">(</span><span class="nx">srcpath</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">exists</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">srcpath</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;absolute srcpath does not exist&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
      <span class="s1">&#39;toCwd&#39;</span><span class="o">:</span> <span class="nx">srcpath</span><span class="p">,</span>
      <span class="s1">&#39;toDst&#39;</span><span class="o">:</span> <span class="nx">srcpath</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">dstdir</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">dstpath</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">relativeToDst</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dstdir</span><span class="p">,</span> <span class="nx">srcpath</span><span class="p">)</span>
    <span class="nx">exists</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">relativeToDst</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;toCwd&#39;</span><span class="o">:</span> <span class="nx">relativeToDst</span><span class="p">,</span>
        <span class="s1">&#39;toDst&#39;</span><span class="o">:</span> <span class="nx">srcpath</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">exists</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">srcpath</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;relative srcpath does not exist&#39;</span><span class="p">)</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="s1">&#39;toCwd&#39;</span><span class="o">:</span> <span class="nx">srcpath</span><span class="p">,</span>
        <span class="s1">&#39;toDst&#39;</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="nx">dstdir</span><span class="p">,</span> <span class="nx">srcpath</span><span class="p">)</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;symlinkPaths&#39;</span><span class="o">:</span> <span class="nx">symlinkPaths</span><span class="p">,</span>
  <span class="s1">&#39;symlinkPathsSync&#39;</span><span class="o">:</span> <span class="nx">symlinkPathsSync</span>
<span class="p">}</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
