<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: node_modules/docco/node_modules/highlight.js/lib/highlight.js</title>
  <link rel="stylesheet" href="../../../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2015-10-31 20:19</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="highlight.js.html/../../../../../../index.html">.</a> / <a href="highlight.js.html/../../../../../index.html">node_modules</a> / <a href="highlight.js.html/../../../../index.html">docco</a> / <a href="highlight.js.html/../../../index.html">node_modules</a> / <a href="highlight.js.html/../../index.html">highlight.js</a> / <a href="highlight.js.html/../index.html">lib</a> / highlight.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          <p>Syntax highlighting with language autodetection.
<a href="https://highlightjs.org/">https://highlightjs.org/</a></p>
        </div>
        <div class='code'>
          
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          <p>Setup highlight.js for different environments. First is Node.js or
CommonJS.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">factory</span><span class="p">)</span> <span class="p">{</span>

  <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">factory</span><span class="p">(</span><span class="nx">exports</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          <p>Export hljs globally even when using AMD for cases when this script
is loaded with others that may still expect a global hljs.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nb">window</span><span class="p">.</span><span class="nx">hljs</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">({});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          <p>Finally register the global hljs with AMD.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">define</span><span class="p">(</span><span class="s1">&#39;hljs&#39;</span><span class="p">,</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">window</span><span class="p">.</span><span class="nx">hljs</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          <p>Utility functions </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="p">}(</span><span class="kd">function</span><span class="p">(</span><span class="nx">hljs</span><span class="p">)</span> <span class="p">{</span>

  <span class="kd">function</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&amp;/gm</span><span class="p">,</span> <span class="s1">&#39;&amp;amp;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;/gm</span><span class="p">,</span> <span class="s1">&#39;&amp;lt;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&gt;/gm</span><span class="p">,</span> <span class="s1">&#39;&amp;gt;&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">tag</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">testRe</span><span class="p">(</span><span class="nx">re</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">re</span> <span class="o">&amp;&amp;</span> <span class="nx">re</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">isNotHighlighted</span><span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="sr">/^(no-?highlight|plain|text)$/i</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">language</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">blockLanguage</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">classes</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">className</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          <p>language-* takes precedence over non-prefixed class names</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">classes</span> <span class="o">+=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">?</span> <span class="nx">block</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">className</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">match</span> <span class="o">=</span> <span class="p">(</span><span class="sr">/\blang(?:uage)?-([\w-]+)\b/i</span><span class="p">).</span><span class="nx">exec</span><span class="p">(</span><span class="nx">classes</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">getLanguage</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">?</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;no-highlight&#39;</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">classes</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">length</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">getLanguage</span><span class="p">(</span><span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">||</span> <span class="nx">isNotHighlighted</span><span class="p">(</span><span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">inherit</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">key</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">parent</span><span class="p">)</span>
      <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">obj</span><span class="p">)</span>
        <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          <p>Stream merging </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">nodeStream</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="p">(</span><span class="kd">function</span> <span class="nx">_nodeStream</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span> <span class="nx">child</span><span class="p">;</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
          <span class="nx">offset</span> <span class="o">+=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">child</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span>
            <span class="nx">offset</span><span class="o">:</span> <span class="nx">offset</span><span class="p">,</span>
            <span class="nx">node</span><span class="o">:</span> <span class="nx">child</span>
          <span class="p">});</span>
          <span class="nx">offset</span> <span class="o">=</span> <span class="nx">_nodeStream</span><span class="p">(</span><span class="nx">child</span><span class="p">,</span> <span class="nx">offset</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          <p>Prevent void elements from having an end tag that would actually
double them in the output. There are more void elements in HTML
but we list only those realistically expected in code display.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tag</span><span class="p">(</span><span class="nx">child</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/br|hr|img|input/</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
              <span class="nx">event</span><span class="o">:</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span>
              <span class="nx">offset</span><span class="o">:</span> <span class="nx">offset</span><span class="p">,</span>
              <span class="nx">node</span><span class="o">:</span> <span class="nx">child</span>
            <span class="p">});</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">offset</span><span class="p">;</span>
    <span class="p">})(</span><span class="nx">node</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">mergeStreams</span><span class="p">(</span><span class="nx">original</span><span class="p">,</span> <span class="nx">highlighted</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">processed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">nodeStack</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="kd">function</span> <span class="nx">selectStream</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">original</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="o">!</span><span class="nx">highlighted</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">original</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">original</span> <span class="o">:</span> <span class="nx">highlighted</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">original</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span> <span class="o">!=</span> <span class="nx">highlighted</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">original</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span> <span class="o">&lt;</span> <span class="nx">highlighted</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span><span class="p">)</span> <span class="o">?</span> <span class="nx">original</span> <span class="o">:</span> <span class="nx">highlighted</span><span class="p">;</span>
      <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          <p>To avoid starting the stream just before it should stop the order is
ensured that original always starts first and closes last:</p>
<p>if (event1 == 'start' &amp;&amp; event2 == 'start')
  return original;
if (event1 == 'start' &amp;&amp; event2 == 'stop')
  return highlighted;
if (event1 == 'stop' &amp;&amp; event2 == 'start')
  return original;
if (event1 == 'stop' &amp;&amp; event2 == 'stop')
  return highlighted;</p>
<p>... which is collapsed to:</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">highlighted</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">event</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span> <span class="o">?</span> <span class="nx">original</span> <span class="o">:</span> <span class="nx">highlighted</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">open</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">function</span> <span class="nx">attr_str</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">+</span> <span class="s1">&#39;=&quot;&#39;</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">;}</span>
      <span class="nx">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">+</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span> <span class="nx">attr_str</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">close</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/&#39;</span> <span class="o">+</span> <span class="nx">tag</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">render</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">event</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span> <span class="o">?</span> <span class="nx">open</span> <span class="o">:</span> <span class="nx">close</span><span class="p">)(</span><span class="nx">event</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">original</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">highlighted</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">stream</span> <span class="o">=</span> <span class="nx">selectStream</span><span class="p">();</span>
      <span class="nx">result</span> <span class="o">+=</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">processed</span><span class="p">,</span> <span class="nx">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span> <span class="o">-</span> <span class="nx">processed</span><span class="p">));</span>
      <span class="nx">processed</span> <span class="o">=</span> <span class="nx">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">stream</span> <span class="o">==</span> <span class="nx">original</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          <p>On any opening or closing tag of the original markup we first close
the entire highlighted node stack, then render the original tag along
with all the following original tags at the same offset and then
reopen all the tags on the highlighted stack.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">nodeStack</span><span class="p">.</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">close</span><span class="p">);</span>
        <span class="k">do</span> <span class="p">{</span>
          <span class="nx">render</span><span class="p">(</span><span class="nx">stream</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
          <span class="nx">stream</span> <span class="o">=</span> <span class="nx">selectStream</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">stream</span> <span class="o">==</span> <span class="nx">original</span> <span class="o">&amp;&amp;</span> <span class="nx">stream</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offset</span> <span class="o">==</span> <span class="nx">processed</span><span class="p">);</span>
        <span class="nx">nodeStack</span><span class="p">.</span><span class="nx">reverse</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">open</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">event</span> <span class="o">==</span> <span class="s1">&#39;start&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">nodeStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stream</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">node</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">nodeStack</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nx">render</span><span class="p">(</span><span class="nx">stream</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">processed</span><span class="p">));</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          <p>Initialization </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">compileLanguage</span><span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">function</span> <span class="nx">reStr</span><span class="p">(</span><span class="nx">re</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">re</span> <span class="o">&amp;&amp;</span> <span class="nx">re</span><span class="p">.</span><span class="nx">source</span><span class="p">)</span> <span class="o">||</span> <span class="nx">re</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">langRe</span><span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">global</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span>
        <span class="nx">reStr</span><span class="p">(</span><span class="nx">value</span><span class="p">),</span>
        <span class="s1">&#39;m&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">case_insensitive</span> <span class="o">?</span> <span class="s1">&#39;i&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">global</span> <span class="o">?</span> <span class="s1">&#39;g&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
      <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">compileMode</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">compiled</span><span class="p">)</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="nx">mode</span><span class="p">.</span><span class="nx">compiled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span> <span class="o">=</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span> <span class="o">||</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">beginKeywords</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">compiled_keywords</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="kd">var</span> <span class="nx">flatten</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span> <span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">language</span><span class="p">.</span><span class="nx">case_insensitive</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
          <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">kw</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">pair</span> <span class="o">=</span> <span class="nx">kw</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">);</span>
            <span class="nx">compiled_keywords</span><span class="p">[</span><span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">className</span><span class="p">,</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">:</span> <span class="mi">1</span><span class="p">];</span>
          <span class="p">});</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// string</span>
          <span class="nx">flatten</span><span class="p">(</span><span class="s1">&#39;keyword&#39;</span><span class="p">,</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">flatten</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span><span class="p">[</span><span class="nx">className</span><span class="p">]);</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span> <span class="o">=</span> <span class="nx">compiled_keywords</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">mode</span><span class="p">.</span><span class="nx">lexemesRe</span> <span class="o">=</span> <span class="nx">langRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">lexemes</span> <span class="o">||</span> <span class="sr">/\b\w+\b/</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">beginKeywords</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">mode</span><span class="p">.</span><span class="nx">begin</span> <span class="o">=</span> <span class="s1">&#39;\\b(&#39;</span> <span class="o">+</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">beginKeywords</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)\\b&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mode</span><span class="p">.</span><span class="nx">begin</span><span class="p">)</span>
          <span class="nx">mode</span><span class="p">.</span><span class="nx">begin</span> <span class="o">=</span> <span class="sr">/\B|\b/</span><span class="p">;</span>
        <span class="nx">mode</span><span class="p">.</span><span class="nx">beginRe</span> <span class="o">=</span> <span class="nx">langRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">begin</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mode</span><span class="p">.</span><span class="nx">end</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">mode</span><span class="p">.</span><span class="nx">endsWithParent</span><span class="p">)</span>
          <span class="nx">mode</span><span class="p">.</span><span class="nx">end</span> <span class="o">=</span> <span class="sr">/\B|\b/</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span>
          <span class="nx">mode</span><span class="p">.</span><span class="nx">endRe</span> <span class="o">=</span> <span class="nx">langRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">end</span><span class="p">);</span>
        <span class="nx">mode</span><span class="p">.</span><span class="nx">terminator_end</span> <span class="o">=</span> <span class="nx">reStr</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">end</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">endsWithParent</span> <span class="o">&amp;&amp;</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">terminator_end</span><span class="p">)</span>
          <span class="nx">mode</span><span class="p">.</span><span class="nx">terminator_end</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">end</span> <span class="o">?</span> <span class="s1">&#39;|&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">terminator_end</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">illegal</span><span class="p">)</span>
        <span class="nx">mode</span><span class="p">.</span><span class="nx">illegalRe</span> <span class="o">=</span> <span class="nx">langRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">illegal</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">relevance</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
        <span class="nx">mode</span><span class="p">.</span><span class="nx">relevance</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">expanded_contains</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">variants</span><span class="p">)</span> <span class="p">{</span>

          <span class="nx">c</span><span class="p">.</span><span class="nx">variants</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span><span class="nx">expanded_contains</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">inherit</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">v</span><span class="p">));});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">expanded_contains</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">c</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span> <span class="o">?</span> <span class="nx">mode</span> <span class="o">:</span> <span class="nx">c</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">});</span>
      <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span> <span class="o">=</span> <span class="nx">expanded_contains</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span><span class="nx">compileMode</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">mode</span><span class="p">);});</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">starts</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">compileMode</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">starts</span><span class="p">,</span> <span class="nx">parent</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">terminators</span> <span class="o">=</span>

        <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">beginKeywords</span> <span class="o">?</span> <span class="s1">&#39;\\.?(&#39;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">begin</span> <span class="o">+</span> <span class="s1">&#39;)\\.?&#39;</span> <span class="o">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">begin</span><span class="p">;</span>
        <span class="p">})</span>
        <span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="nx">mode</span><span class="p">.</span><span class="nx">terminator_end</span><span class="p">,</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">illegal</span><span class="p">])</span>
        <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">reStr</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">mode</span><span class="p">.</span><span class="nx">terminators</span> <span class="o">=</span> <span class="nx">terminators</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">langRe</span><span class="p">(</span><span class="nx">terminators</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">),</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="p">{</span><span class="nx">exec</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="cm">/*s*/</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="kc">null</span><span class="p">;}};</span>
    <span class="p">}</span>

    <span class="nx">compileMode</span><span class="p">(</span><span class="nx">language</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>Core highlighting function. Accepts a language name, or an alias, and a
string with the code to highlight. Returns an object with the following
properties:</p>
<ul>
<li>relevance (int)</li>
<li>value (an HTML string with highlighting markup)</li>
</ul>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">highlight</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">ignore_illegals</span><span class="p">,</span> <span class="nx">continuation</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">function</span> <span class="nx">subMode</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">,</span> <span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">testRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">beginRe</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">endOfMode</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">testRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">endRe</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">endsParent</span> <span class="o">&amp;&amp;</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">mode</span> <span class="o">=</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">mode</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">endsWithParent</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">endOfMode</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">isIllegal</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">,</span> <span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">!</span><span class="nx">ignore_illegals</span> <span class="o">&amp;&amp;</span> <span class="nx">testRe</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">illegalRe</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">keywordMatch</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">match_str</span> <span class="o">=</span> <span class="nx">language</span><span class="p">.</span><span class="nx">case_insensitive</span> <span class="o">?</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">:</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">return</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">match_str</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">keywords</span><span class="p">[</span><span class="nx">match_str</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">buildSpan</span><span class="p">(</span><span class="nx">classname</span><span class="p">,</span> <span class="nx">insideSpan</span><span class="p">,</span> <span class="nx">leaveOpen</span><span class="p">,</span> <span class="nx">noPrefix</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">classPrefix</span> <span class="o">=</span> <span class="nx">noPrefix</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">classPrefix</span><span class="p">,</span>
          <span class="nx">openSpan</span>    <span class="o">=</span> <span class="s1">&#39;&lt;span class=&quot;&#39;</span> <span class="o">+</span> <span class="nx">classPrefix</span><span class="p">,</span>
          <span class="nx">closeSpan</span>   <span class="o">=</span> <span class="nx">leaveOpen</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>

      <span class="nx">openSpan</span> <span class="o">+=</span> <span class="nx">classname</span> <span class="o">+</span> <span class="s1">&#39;&quot;&gt;&#39;</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">openSpan</span> <span class="o">+</span> <span class="nx">insideSpan</span> <span class="o">+</span> <span class="nx">closeSpan</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processKeywords</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">top</span><span class="p">.</span><span class="nx">keywords</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">last_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="nx">top</span><span class="p">.</span><span class="nx">lexemesRe</span><span class="p">.</span><span class="nx">lastIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">top</span><span class="p">.</span><span class="nx">lexemesRe</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">last_index</span><span class="p">,</span> <span class="nx">match</span><span class="p">.</span><span class="nx">index</span> <span class="o">-</span> <span class="nx">last_index</span><span class="p">));</span>
        <span class="kd">var</span> <span class="nx">keyword_match</span> <span class="o">=</span> <span class="nx">keywordMatch</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">keyword_match</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">relevance</span> <span class="o">+=</span> <span class="nx">keyword_match</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="nx">buildSpan</span><span class="p">(</span><span class="nx">keyword_match</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">last_index</span> <span class="o">=</span> <span class="nx">top</span><span class="p">.</span><span class="nx">lexemesRe</span><span class="p">.</span><span class="nx">lastIndex</span><span class="p">;</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="nx">top</span><span class="p">.</span><span class="nx">lexemesRe</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">result</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">last_index</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processSubLanguage</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">explicit</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span> <span class="o">==</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">explicit</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">languages</span><span class="p">[</span><span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">explicit</span> <span class="o">?</span>
                   <span class="nx">highlight</span><span class="p">(</span><span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span><span class="p">,</span> <span class="nx">mode_buffer</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">continuations</span><span class="p">[</span><span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span><span class="p">])</span> <span class="o">:</span>
                   <span class="nx">highlightAuto</span><span class="p">(</span><span class="nx">mode_buffer</span><span class="p">,</span> <span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span><span class="p">.</span><span class="nx">length</span> <span class="o">?</span> <span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>Counting embedded language score towards the host language may be disabled
with zeroing the containing mode relevance. Usecase in point is Markdown that
allows XML everywhere and makes every XML snippet to have a much larger Markdown
score.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">top</span><span class="p">.</span><span class="nx">relevance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">relevance</span> <span class="o">+=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">relevance</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">explicit</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">continuations</span><span class="p">[</span><span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span><span class="p">]</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">buildSpan</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processBuffer</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">top</span><span class="p">.</span><span class="nx">subLanguage</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">?</span> <span class="nx">processSubLanguage</span><span class="p">()</span> <span class="o">:</span> <span class="nx">processKeywords</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">startNewMode</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">markup</span> <span class="o">=</span> <span class="nx">mode</span><span class="p">.</span><span class="nx">className</span><span class="o">?</span> <span class="nx">buildSpan</span><span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">className</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">returnBegin</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">markup</span><span class="p">;</span>
        <span class="nx">mode_buffer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span><span class="p">.</span><span class="nx">excludeBegin</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">)</span> <span class="o">+</span> <span class="nx">markup</span><span class="p">;</span>
        <span class="nx">mode_buffer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">markup</span><span class="p">;</span>
        <span class="nx">mode_buffer</span> <span class="o">=</span> <span class="nx">lexeme</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">top</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">mode</span><span class="p">,</span> <span class="p">{</span><span class="nx">parent</span><span class="o">:</span> <span class="p">{</span><span class="nx">value</span><span class="o">:</span> <span class="nx">top</span><span class="p">}});</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">processLexeme</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">mode_buffer</span> <span class="o">+=</span> <span class="nx">buffer</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lexeme</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">processBuffer</span><span class="p">();</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">new_mode</span> <span class="o">=</span> <span class="nx">subMode</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">,</span> <span class="nx">top</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">new_mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">processBuffer</span><span class="p">();</span>
        <span class="nx">startNewMode</span><span class="p">(</span><span class="nx">new_mode</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">new_mode</span><span class="p">.</span><span class="nx">returnBegin</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">lexeme</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="kd">var</span> <span class="nx">end_mode</span> <span class="o">=</span> <span class="nx">endOfMode</span><span class="p">(</span><span class="nx">top</span><span class="p">,</span> <span class="nx">lexeme</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">end_mode</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">origin</span> <span class="o">=</span> <span class="nx">top</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">origin</span><span class="p">.</span><span class="nx">returnEnd</span> <span class="o">||</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">excludeEnd</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">mode_buffer</span> <span class="o">+=</span> <span class="nx">lexeme</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">result</span> <span class="o">+=</span> <span class="nx">processBuffer</span><span class="p">();</span>
        <span class="k">do</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">top</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">relevance</span> <span class="o">+=</span> <span class="nx">top</span><span class="p">.</span><span class="nx">relevance</span><span class="p">;</span>
          <span class="nx">top</span> <span class="o">=</span> <span class="nx">top</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">top</span> <span class="o">!=</span> <span class="nx">end_mode</span><span class="p">.</span><span class="nx">parent</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">origin</span><span class="p">.</span><span class="nx">excludeEnd</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">mode_buffer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">end_mode</span><span class="p">.</span><span class="nx">starts</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">startNewMode</span><span class="p">(</span><span class="nx">end_mode</span><span class="p">.</span><span class="nx">starts</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">origin</span><span class="p">.</span><span class="nx">returnEnd</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">lexeme</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">isIllegal</span><span class="p">(</span><span class="nx">lexeme</span><span class="p">,</span> <span class="nx">top</span><span class="p">))</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Illegal lexeme &quot;&#39;</span> <span class="o">+</span> <span class="nx">lexeme</span> <span class="o">+</span> <span class="s1">&#39;&quot; for mode &quot;&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">top</span><span class="p">.</span><span class="nx">className</span> <span class="o">||</span> <span class="s1">&#39;&lt;unnamed&gt;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>Parser should not reach this point as all types of lexemes should be caught
earlier, but if it does due to some bug make sure it advances at least one
character forward to prevent infinite looping.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">mode_buffer</span> <span class="o">+=</span> <span class="nx">lexeme</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">lexeme</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">language</span> <span class="o">=</span> <span class="nx">getLanguage</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Unknown language: &quot;&#39;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">compileLanguage</span><span class="p">(</span><span class="nx">language</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">continuation</span> <span class="o">||</span> <span class="nx">language</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">continuations</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// keep continuations for sub-languages</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">current</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">top</span><span class="p">;</span> <span class="nx">current</span> <span class="o">!=</span> <span class="nx">language</span><span class="p">;</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">buildSpan</span><span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">className</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">+</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">mode_buffer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">relevance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">top</span><span class="p">.</span><span class="nx">terminators</span><span class="p">.</span><span class="nx">lastIndex</span> <span class="o">=</span> <span class="nx">index</span><span class="p">;</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="nx">top</span><span class="p">.</span><span class="nx">terminators</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="nx">count</span> <span class="o">=</span> <span class="nx">processLexeme</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">match</span><span class="p">.</span><span class="nx">index</span> <span class="o">-</span> <span class="nx">index</span><span class="p">),</span> <span class="nx">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">index</span> <span class="o">+</span> <span class="nx">count</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">processLexeme</span><span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">index</span><span class="p">));</span>
      <span class="k">for</span><span class="p">(</span><span class="nx">current</span> <span class="o">=</span> <span class="nx">top</span><span class="p">;</span> <span class="nx">current</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// close dangling modes</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">className</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="nx">relevance</span><span class="o">:</span> <span class="nx">relevance</span><span class="p">,</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">result</span><span class="p">,</span>
        <span class="nx">language</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span>
        <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span>
      <span class="p">};</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;Illegal&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span>
          <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
        <span class="p">};</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nx">e</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          <p>Highlighting with language detection. Accepts a string with the code to
highlight. Returns an object with the following properties:</p>
<ul>
<li>language (detected language)</li>
<li>relevance (int)</li>
<li>value (an HTML string with highlighting markup)</li>
<li>second_best (object with the same structure for second-best heuristically
  detected language, may be absent)</li>
</ul>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">highlightAuto</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">languageSubset</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">languageSubset</span> <span class="o">=</span> <span class="nx">languageSubset</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">languages</span> <span class="o">||</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">languages</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span>
    <span class="p">};</span>
    <span class="kd">var</span> <span class="nx">second_best</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>

    <span class="nx">languageSubset</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">getLanguage</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">highlight</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
      <span class="nx">current</span><span class="p">.</span><span class="nx">language</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">relevance</span> <span class="o">&gt;</span> <span class="nx">second_best</span><span class="p">.</span><span class="nx">relevance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">second_best</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">current</span><span class="p">.</span><span class="nx">relevance</span> <span class="o">&gt;</span> <span class="nx">result</span><span class="p">.</span><span class="nx">relevance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">second_best</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">current</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">second_best</span><span class="p">.</span><span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">second_best</span> <span class="o">=</span> <span class="nx">second_best</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>Post-processing of the highlighted markup:</p>
<ul>
<li>replace TABs with something more useful</li>
<li>replace real line-breaks with '<br>' for non-pre containers</li>
</ul>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">fixMarkup</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">tabReplace</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^((&lt;[^&gt;]+&gt;|\t)+)/gm</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">p1</span> <span class="cm">/*..., offset, s*/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\t/g</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">tabReplace</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">useBR</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">buildClassName</span><span class="p">(</span><span class="nx">prevClassName</span><span class="p">,</span> <span class="nx">currentLang</span><span class="p">,</span> <span class="nx">resultLang</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">language</span> <span class="o">=</span> <span class="nx">currentLang</span> <span class="o">?</span> <span class="nx">aliases</span><span class="p">[</span><span class="nx">currentLang</span><span class="p">]</span> <span class="o">:</span> <span class="nx">resultLang</span><span class="p">,</span>
        <span class="nx">result</span>   <span class="o">=</span> <span class="p">[</span><span class="nx">prevClassName</span><span class="p">.</span><span class="nx">trim</span><span class="p">()];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">prevClassName</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/\bhljs\b/</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;hljs&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">prevClassName</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">language</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">language</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          <p>Applies highlighting to a DOM node containing code. Accepts a DOM node and
two optional parameters for fixMarkup.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">highlightBlock</span><span class="p">(</span><span class="nx">block</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">language</span> <span class="o">=</span> <span class="nx">blockLanguage</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">isNotHighlighted</span><span class="p">(</span><span class="nx">language</span><span class="p">))</span>
        <span class="k">return</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">node</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">useBR</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElementNS</span><span class="p">(</span><span class="s1">&#39;http://www.w3.org/1999/xhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">);</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">block</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;br[ \/]*&gt;/g</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">node</span> <span class="o">=</span> <span class="nx">block</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">language</span> <span class="o">?</span> <span class="nx">highlight</span><span class="p">(</span><span class="nx">language</span><span class="p">,</span> <span class="nx">text</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="o">:</span> <span class="nx">highlightAuto</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">originalStream</span> <span class="o">=</span> <span class="nx">nodeStream</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">originalStream</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">resultNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElementNS</span><span class="p">(</span><span class="s1">&#39;http://www.w3.org/1999/xhtml&#39;</span><span class="p">,</span> <span class="s1">&#39;div&#39;</span><span class="p">);</span>
      <span class="nx">resultNode</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">mergeStreams</span><span class="p">(</span><span class="nx">originalStream</span><span class="p">,</span> <span class="nx">nodeStream</span><span class="p">(</span><span class="nx">resultNode</span><span class="p">),</span> <span class="nx">text</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">result</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">fixMarkup</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

    <span class="nx">block</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">block</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">buildClassName</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">className</span><span class="p">,</span> <span class="nx">language</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">language</span><span class="p">);</span>
    <span class="nx">block</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">language</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span>
      <span class="nx">re</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">relevance</span>
    <span class="p">};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">second_best</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">block</span><span class="p">.</span><span class="nx">second_best</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">language</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">second_best</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span>
        <span class="nx">re</span><span class="o">:</span> <span class="nx">result</span><span class="p">.</span><span class="nx">second_best</span><span class="p">.</span><span class="nx">relevance</span>
      <span class="p">};</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">classPrefix</span><span class="o">:</span> <span class="s1">&#39;hljs-&#39;</span><span class="p">,</span>
    <span class="nx">tabReplace</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="nx">useBR</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">languages</span><span class="o">:</span> <span class="kc">undefined</span>
  <span class="p">};</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          <p>Updates highlight.js global options with values passed in the form of an object</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">configure</span><span class="p">(</span><span class="nx">user_options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">inherit</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">user_options</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          <p>Applies highlighting to all <pre><code>..</code></pre> blocks on a page.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">initHighlighting</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">initHighlighting</span><span class="p">.</span><span class="nx">called</span><span class="p">)</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="nx">initHighlighting</span><span class="p">.</span><span class="nx">called</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">blocks</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;pre code&#39;</span><span class="p">);</span>
    <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">forEach</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">blocks</span><span class="p">,</span> <span class="nx">highlightBlock</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          <p>Attaches highlighting to the page load event.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">initHighlightingOnLoad</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;DOMContentLoaded&#39;</span><span class="p">,</span> <span class="nx">initHighlighting</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">initHighlighting</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">languages</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">aliases</span> <span class="o">=</span> <span class="p">{};</span>

  <span class="kd">function</span> <span class="nx">registerLanguage</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">language</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lang</span> <span class="o">=</span> <span class="nx">languages</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">language</span><span class="p">(</span><span class="nx">hljs</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lang</span><span class="p">.</span><span class="nx">aliases</span><span class="p">)</span> <span class="p">{</span>

      <span class="nx">lang</span><span class="p">.</span><span class="nx">aliases</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">alias</span><span class="p">)</span> <span class="p">{</span><span class="nx">aliases</span><span class="p">[</span><span class="nx">alias</span><span class="p">]</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;});</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">listLanguages</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">languages</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">getLanguage</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="p">(</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">languages</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="nx">languages</span><span class="p">[</span><span class="nx">aliases</span><span class="p">[</span><span class="nx">name</span><span class="p">]];</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          <p>Interface definition </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">hljs</span><span class="p">.</span><span class="nx">highlight</span> <span class="o">=</span> <span class="nx">highlight</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">highlightAuto</span> <span class="o">=</span> <span class="nx">highlightAuto</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">fixMarkup</span> <span class="o">=</span> <span class="nx">fixMarkup</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">highlightBlock</span> <span class="o">=</span> <span class="nx">highlightBlock</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">configure</span> <span class="o">=</span> <span class="nx">configure</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">initHighlighting</span> <span class="o">=</span> <span class="nx">initHighlighting</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">initHighlightingOnLoad</span> <span class="o">=</span> <span class="nx">initHighlightingOnLoad</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">registerLanguage</span> <span class="o">=</span> <span class="nx">registerLanguage</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">listLanguages</span> <span class="o">=</span> <span class="nx">listLanguages</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">getLanguage</span> <span class="o">=</span> <span class="nx">getLanguage</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">inherit</span> <span class="o">=</span> <span class="nx">inherit</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>Common regexps</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">hljs</span><span class="p">.</span><span class="nx">IDENT_RE</span> <span class="o">=</span> <span class="s1">&#39;[a-zA-Z]\\w*&#39;</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">UNDERSCORE_IDENT_RE</span> <span class="o">=</span> <span class="s1">&#39;[a-zA-Z_]\\w*&#39;</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">NUMBER_RE</span> <span class="o">=</span> <span class="s1">&#39;\\b\\d+(\\.\\d+)?&#39;</span><span class="p">;</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">C_NUMBER_RE</span> <span class="o">=</span> <span class="s1">&#39;(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)&#39;</span><span class="p">;</span> <span class="c1">// 0x..., 0..., decimal, float</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">BINARY_NUMBER_RE</span> <span class="o">=</span> <span class="s1">&#39;\\b(0b[01]+)&#39;</span><span class="p">;</span> <span class="c1">// 0b...</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">RE_STARTERS_RE</span> <span class="o">=</span> <span class="s1">&#39;!|!=|!==|%|%=|&amp;|&amp;&amp;|&amp;=|\\*|\\*=|\\+|\\+=|,|-|-=|/=|/|:|;|&lt;&lt;|&lt;&lt;=|&lt;=|&lt;|===|==|=|&gt;&gt;&gt;=|&gt;&gt;=|&gt;=|&gt;&gt;&gt;|&gt;&gt;|&gt;|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~&#39;</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          <p>Common modes</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">hljs</span><span class="p">.</span><span class="nx">BACKSLASH_ESCAPE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="s1">&#39;\\\\[\\s\\S]&#39;</span><span class="p">,</span> <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">APOS_STRING_MODE</span> <span class="o">=</span> <span class="p">{</span>

    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span> <span class="s1">&#39;\&#39;&#39;</span><span class="p">,</span>
    <span class="nx">illegal</span><span class="o">:</span> <span class="s1">&#39;\\n&#39;</span><span class="p">,</span>
    <span class="nx">contains</span><span class="o">:</span> <span class="p">[</span><span class="nx">hljs</span><span class="p">.</span><span class="nx">BACKSLASH_ESCAPE</span><span class="p">]</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">QUOTE_STRING_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-31" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-31'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">,</span>
    <span class="nx">illegal</span><span class="o">:</span> <span class="s1">&#39;\\n&#39;</span><span class="p">,</span>
    <span class="nx">contains</span><span class="o">:</span> <span class="p">[</span><span class="nx">hljs</span><span class="p">.</span><span class="nx">BACKSLASH_ESCAPE</span><span class="p">]</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">PHRASAL_WORDS_MODE</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="sr">/\b(a|an|the|are|I|I&#39;m|isn&#39;t|don&#39;t|doesn&#39;t|won&#39;t|but|just|should|pretty|simply|enough|gonna|going|wtf|so|such|will|you|your|like)\b/</span>
  <span class="p">};</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-32" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-32'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">hljs</span><span class="p">.</span><span class="nx">COMMENT</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="p">,</span> <span class="nx">inherits</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">mode</span> <span class="o">=</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">inherit</span><span class="p">(</span>
      <span class="p">{</span>

        <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;comment&#39;</span><span class="p">,</span>
        <span class="nx">begin</span><span class="o">:</span> <span class="nx">begin</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span> <span class="nx">end</span><span class="p">,</span>
        <span class="nx">contains</span><span class="o">:</span> <span class="p">[]</span>
      <span class="p">},</span>
      <span class="nx">inherits</span> <span class="o">||</span> <span class="p">{}</span>
    <span class="p">);</span>
    <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hljs</span><span class="p">.</span><span class="nx">PHRASAL_WORDS_MODE</span><span class="p">);</span>
    <span class="nx">mode</span><span class="p">.</span><span class="nx">contains</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-33" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-33'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;doctag&#39;</span><span class="p">,</span>
      <span class="nx">begin</span><span class="o">:</span> <span class="s2">&quot;(?:TODO|FIXME|NOTE|BUG|XXX):&quot;</span><span class="p">,</span>
      <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">mode</span><span class="p">;</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">C_LINE_COMMENT_MODE</span> <span class="o">=</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">COMMENT</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">);</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">C_BLOCK_COMMENT_MODE</span> <span class="o">=</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">COMMENT</span><span class="p">(</span><span class="s1">&#39;/\\*&#39;</span><span class="p">,</span> <span class="s1">&#39;\\*/&#39;</span><span class="p">);</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">HASH_COMMENT_MODE</span> <span class="o">=</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">COMMENT</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">);</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">NUMBER_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-34" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-34'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">NUMBER_RE</span><span class="p">,</span>
    <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">C_NUMBER_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-35" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-35'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">C_NUMBER_RE</span><span class="p">,</span>
    <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">BINARY_NUMBER_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-36" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-36'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">BINARY_NUMBER_RE</span><span class="p">,</span>
    <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">CSS_NUMBER_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-37" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-37'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">NUMBER_RE</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;%|em|ex|ch|rem&#39;</span>  <span class="o">+</span>
      <span class="s1">&#39;|vw|vh|vmin|vmax&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;|cm|mm|in|pt|pc|px&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;|deg|grad|rad|turn&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;|s|ms&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;|Hz|kHz&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;|dpi|dpcm|dppx&#39;</span> <span class="o">+</span>
      <span class="s1">&#39;)?&#39;</span><span class="p">,</span>
    <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">REGEXP_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-38" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-38'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;regexp&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="sr">/\//</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span> <span class="sr">/\/[gimuy]*/</span><span class="p">,</span>
    <span class="nx">illegal</span><span class="o">:</span> <span class="sr">/\n/</span><span class="p">,</span>
    <span class="nx">contains</span><span class="o">:</span> <span class="p">[</span>
      <span class="nx">hljs</span><span class="p">.</span><span class="nx">BACKSLASH_ESCAPE</span><span class="p">,</span>
      <span class="p">{</span>
        <span class="nx">begin</span><span class="o">:</span> <span class="sr">/\[/</span><span class="p">,</span> <span class="nx">end</span><span class="o">:</span> <span class="sr">/\]/</span><span class="p">,</span>
        <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">contains</span><span class="o">:</span> <span class="p">[</span><span class="nx">hljs</span><span class="p">.</span><span class="nx">BACKSLASH_ESCAPE</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">TITLE_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-39" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-39'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">IDENT_RE</span><span class="p">,</span>
    <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>
  <span class="nx">hljs</span><span class="p">.</span><span class="nx">UNDERSCORE_TITLE_MODE</span> <span class="o">=</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-40" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-40'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">className</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="nx">hljs</span><span class="p">.</span><span class="nx">UNDERSCORE_IDENT_RE</span><span class="p">,</span>
    <span class="nx">relevance</span><span class="o">:</span> <span class="mi">0</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="nx">hljs</span><span class="p">;</span>
<span class="p">}));</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
